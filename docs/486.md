# PHP 8 çš„æ–°ç‰¹æ€§(ç‰¹æ€§ã€æ”¹è¿›å’Œ JIT ç¼–è¯‘å™¨)

> åŸæ–‡ï¼š<https://kinsta.com/blog/php-8/>

PHP 8 å·²ç»æ­£å¼å‘å¸ƒåˆ° 2020 å¹´ 11 æœˆ 26 æ—¥å…¨é¢ä¸Šå¸‚ï¼

è¿™ä¸€æ–°çš„é‡å¤§æ›´æ–°ä¸ºè¯¥è¯­è¨€å¸¦æ¥äº†è®¸å¤šä¼˜åŒ–å’Œå¼ºå¤§çš„åŠŸèƒ½ã€‚æˆ‘ä»¬å¾ˆé«˜å…´å‘æ‚¨ä»‹ç»æœ€æœ‰è¶£çš„å˜åŒ–ï¼Œè¿™äº›å˜åŒ–å°†å…è®¸æˆ‘ä»¬ç¼–å†™æ›´å¥½çš„ä»£ç å¹¶æ„å»ºæ›´å¥å£®çš„åº”ç”¨ç¨‹åºã€‚

![PHP 8 released](img/f24d1389f20134af8ed714c3817a1e1f.png)

[PHP 8.0 Announcement Addendum](https://www.php.net/releases/8.0/en.php)



ä½ å‡†å¤‡å¥½äº†å—ï¼Ÿè®©æˆ‘ä»¬å¼€å§‹å§ï¼

## PHP JIT(å®æ—¶ç¼–è¯‘å™¨)

PHP 8 æœ€å—æ¬¢è¿çš„ç‰¹æ€§æ˜¯**å®æ—¶(JIT)ç¼–è¯‘å™¨**ã€‚JIT åˆ°åº•æ˜¯ä»€ä¹ˆï¼Ÿ

[RFC å»ºè®®ä¹¦](https://wiki.php.net/rfc/jit)å¯¹ JIT çš„æè¿°å¦‚ä¸‹:

> â€œPHP JIT æ˜¯ä½œä¸º OPcache çš„ä¸€ä¸ªå‡ ä¹ç‹¬ç«‹çš„éƒ¨åˆ†å®ç°çš„ã€‚å®ƒå¯ä»¥åœ¨ PHP ç¼–è¯‘æ—¶å’Œè¿è¡Œæ—¶å¯ç”¨/ç¦ç”¨ã€‚å¯ç”¨æ—¶ï¼ŒPHP æ–‡ä»¶çš„æœ¬æœºä»£ç å­˜å‚¨åœ¨ OPcache å…±äº«å†…å­˜çš„é™„åŠ åŒºåŸŸï¼Œop_arrayâ†’opcodes[]ã€‚å¤„ç†ç¨‹åºä¿å­˜æŒ‡å‘ JIT ä»£ç å…¥å£ç‚¹çš„æŒ‡é’ˆã€‚

é‚£ä¹ˆï¼Œæˆ‘ä»¬æ˜¯æ€ä¹ˆåˆ° JIT çš„ï¼ŒJIT å’Œ OPcache æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ





> éœ€è¦åœ¨è¿™é‡Œå¤§å£°å–Šå‡ºæ¥ã€‚Kinsta å¤ªç¥å¥‡äº†ï¼Œæˆ‘ç”¨å®ƒåšæˆ‘çš„ä¸ªäººç½‘ç«™ã€‚æ”¯æŒæ˜¯è¿…é€Ÿå’Œæ°å‡ºçš„ï¼Œä»–ä»¬çš„æœåŠ¡å™¨æ˜¯ WordPress æœ€å¿«çš„ã€‚
> 
> <footer class="wp-block-kinsta-client-quote__footer">
> 
> ![A picture of Phillip Stemann looking into the camera wearing a blue button down shirt](img/12b77bdcd297e9bf069df2f3413ad833.png)
> 
> <cite class="wp-block-kinsta-client-quote__cite">Phillip Stemann</cite></footer>

[View plans](https://kinsta.com/plans/)

ä¸ºäº†æ›´å¥½åœ°ç†è§£ PHP çš„ JIT æ˜¯ä»€ä¹ˆï¼Œè®©æˆ‘ä»¬å¿«é€Ÿçœ‹ä¸€ä¸‹ [PHP](https://kinsta.com/knowledgebase/what-is-php/) å¦‚ä½•æ‰§è¡Œæºä»£ç å¾—åˆ°æœ€ç»ˆç»“æœã€‚

PHP çš„æ‰§è¡Œåˆ†ä¸º 4 ä¸ªé˜¶æ®µ:

*   **è¯æ³•åˆ†æ/æ ‡è®°åŒ–**:é¦–å…ˆï¼Œè§£é‡Šå™¨è¯»å– PHP ä»£ç å¹¶æ„å»ºä¸€ç»„æ ‡è®°ã€‚
*   **è§£æ**:è§£é‡Šå™¨æ£€æŸ¥è„šæœ¬æ˜¯å¦åŒ¹é…è¯­æ³•è§„åˆ™ï¼Œå¹¶ä½¿ç”¨ä»¤ç‰Œæ„å»º[æŠ½è±¡è¯­æ³•æ ‘](https://en.wikipedia.org/wiki/Abstract_syntax_tree)(AST)[æºä»£ç ç»“æ„çš„åˆ†å±‚è¡¨ç¤º](https://wiki.php.net/rfc/abstract_syntax_tree)ã€‚

*   **ç¼–è¯‘**:è§£é‡Šå™¨éå†æ ‘ï¼Œå°† AST èŠ‚ç‚¹ç¿»è¯‘æˆä½çº§ Zend æ“ä½œç ï¼Œè¿™æ˜¯ç¡®å®šç”± Zend VM æ‰§è¡Œçš„[æŒ‡ä»¤ç±»å‹çš„æ•°å­—æ ‡è¯†ç¬¦ã€‚](https://nikic.github.io/2017/04/14/PHP-7-Virtual-machine.html)
*   **è§£é‡Š**:æ“ä½œç åœ¨ Zend VM ä¸Šè¢«è§£é‡Šå¹¶è¿è¡Œã€‚

ä¸‹å›¾æ˜¾ç¤ºäº†åŸºæœ¬ PHP æ‰§è¡Œè¿‡ç¨‹çš„å¯è§†åŒ–è¡¨ç¤ºã€‚

![Basic PHP execution process](img/f45f44aa7025ea818d2fe4fc49e08c5f.png)

Basic PHP execution process



é‚£ä¹ˆï¼ŒOPcache æ˜¯å¦‚ä½•è®© PHP æ›´å¿«çš„å‘¢ï¼Ÿè€Œ JIT åœ¨æ‰§è¡Œè¿‡ç¨‹ä¸­æœ‰å“ªäº›æ”¹å˜ï¼Ÿ

### OPcache æ‰©å±•

PHP æ˜¯ä¸€ç§è§£é‡Šå‹è¯­è¨€ã€‚è¿™æ„å‘³ç€ï¼Œå½“ PHP è„šæœ¬è¿è¡Œæ—¶ï¼Œè§£é‡Šå™¨å¯¹æ¯ä¸ªè¯·æ±‚ä¸€éåˆä¸€éåœ°è§£æã€ç¼–è¯‘å’Œæ‰§è¡Œä»£ç ã€‚è¿™å¯èƒ½å¯¼è‡´[æµªè´¹ CPU èµ„æº](https://phptherightway.com/#opcode_cache)å’Œé¢å¤–çš„æ—¶é—´ã€‚

è¿™å°±æ˜¯ [OPcache æ‰©å±•](https://www.php.net/manual/en/intro.opcache.php)å‘æŒ¥ä½œç”¨çš„åœ°æ–¹:

> OPcache é€šè¿‡åœ¨å…±äº«å†…å­˜ä¸­å­˜å‚¨é¢„ç¼–è¯‘çš„è„šæœ¬å­—èŠ‚ç æ¥æé«˜ PHP æ€§èƒ½ï¼Œä»è€Œä½¿ PHP æ— éœ€åœ¨æ¯æ¬¡è¯·æ±‚æ—¶åŠ è½½å’Œè§£æè„šæœ¬

å¯ç”¨ OPcache åï¼ŒPHP è§£é‡Šå™¨åªæœ‰åœ¨è„šæœ¬ç¬¬ä¸€æ¬¡è¿è¡Œæ—¶æ‰ä¼šç»å†ä¸Šé¢æåˆ°çš„ 4 ä¸ªé˜¶æ®µã€‚ç”±äº PHP å­—èŠ‚ç å­˜å‚¨åœ¨å…±äº«å†…å­˜ä¸­ï¼Œå®ƒä»¬å¯ä»¥ä½œä¸ºåº•å±‚çš„ä¸­é—´è¡¨ç¤ºç«‹å³ä½¿ç”¨ï¼Œå¹¶ä¸”å¯ä»¥ç«‹å³åœ¨ Zend VM ä¸Šæ‰§è¡Œã€‚

![PHP execution process with OPcache enabled](img/30a9fa1de5053012ec7fbfaa7e77506d.png)

PHP execution process with OPcache enabled



ä» PHP 5.5 å¼€å§‹ï¼ŒZend OPcache æ‰©å±•æ˜¯é»˜è®¤å¯ç”¨çš„ï¼Œä½ å¯ä»¥é€šè¿‡ç®€å•çš„[ä»ä½ çš„æœåŠ¡å™¨ä¸Šçš„è„šæœ¬è°ƒç”¨`phpinfo()`](https://kinsta.com/knowledgebase/phpinfo/) æˆ–è€…æ£€æŸ¥ä½ çš„ php.ini æ–‡ä»¶æ¥æ£€æŸ¥ä½ æ˜¯å¦æ­£ç¡®é…ç½®äº†å®ƒ(å‚è§ [OPcache é…ç½®è®¾ç½®](https://www.php.net/manual/en/opcache.configuration.php))ã€‚

å»ºè®®é˜…è¯»:[å¦‚ä½•åœ¨ WordPress](https://kinsta.com/knowledgebase/php-memory-limit/) ä¸­æé«˜ PHP å†…å­˜é™åˆ¶ã€‚

![Zend OPcache section in a phpinfo page](img/aabd64fb4be524a12de350d2a5b44e14.png)

Zend OPcache section in a phpinfo page



### é¢„åŠ è½½

OPcache æœ€è¿‘éšç€[é¢„åŠ è½½](https://wiki.php.net/rfc/preload)çš„å®ç°å¾—åˆ°äº†æ”¹è¿›ï¼Œè¿™æ˜¯ [PHP 7.4](https://kinsta.com/blog/php-7-4/) å¢åŠ çš„ä¸€ä¸ªæ–°çš„ OPcache ç‰¹æ€§ã€‚é¢„åŠ è½½æä¾›äº†ä¸€ç§åœ¨è¿è¡Œä»»ä½•åº”ç”¨ç¨‹åºä»£ç ä¹‹å‰å°†ä¸€ç»„æŒ‡å®šçš„è„šæœ¬å­˜å‚¨åˆ° OPcache å­˜å‚¨å™¨*ä¸­çš„æ–¹æ³•ã€‚*â€œå°½ç®¡å¦‚æ­¤ï¼Œå®ƒå¹¶æ²¡æœ‰ä¸ºå…¸å‹çš„åŸºäº web çš„åº”ç”¨ç¨‹åºå¸¦æ¥åˆ‡å®çš„æ€§èƒ½æå‡ã€‚

ä½ å¯ä»¥åœ¨æˆ‘ä»¬çš„ PHP 7.4 ç®€ä»‹ä¸­é˜…è¯»æ›´å¤šå…³äºé¢„åŠ è½½çš„å†…å®¹ã€‚

æœ‰äº† JITï¼ŒPHP å‘å‰è¿ˆè¿›äº†ä¸€æ­¥ã€‚

### JITâ€”â€”å®æ—¶ç¼–è¯‘å™¨

å³ä½¿æ“ä½œç æ˜¯ä½çº§çš„ä¸­é—´è¡¨ç¤ºï¼Œä»ç„¶è¦ç¼–è¯‘æˆæœºå™¨ç ã€‚JITâ€œæ²¡æœ‰å¼•å…¥ä»»ä½•é¢å¤–çš„ IR(ä¸­é—´è¡¨ç¤º)å½¢å¼â€ï¼Œè€Œæ˜¯ä½¿ç”¨ [DynASM](https://luajit.org/dynasm.html) (ä»£ç ç”Ÿæˆå¼•æ“çš„åŠ¨æ€æ±‡ç¼–å™¨)ç›´æ¥ä» PHP å­—èŠ‚ç ç”ŸæˆåŸç”Ÿä»£ç ã€‚

ç®€è€Œè¨€ä¹‹ï¼Œ **JIT å°†ä¸­é—´ä»£ç çš„çƒ­éƒ¨åˆ†ç¿»è¯‘æˆæœºå™¨ç **ã€‚ç»•è¿‡ç¼–è¯‘ï¼Œå®ƒå°†èƒ½å¤Ÿåœ¨æ€§èƒ½å’Œå†…å­˜ä½¿ç”¨æ–¹é¢å¸¦æ¥ç›¸å½“å¤§çš„æ”¹è¿›ã€‚

PHP JIT ææ¡ˆçš„åˆè‘—è€… Zeev Surasky å±•ç¤ºäº†ä½¿ç”¨ JIT å¯ä»¥åŠ å¿«å¤šå°‘è®¡ç®—é€Ÿåº¦:



ä½†æ˜¯ï¼ŒJIT èƒ½æœ‰æ•ˆåœ°æé«˜ WordPress çš„æ€§èƒ½å—ï¼Ÿ

### å®æ—¶ Web åº”ç”¨çš„ JIT

æ ¹æ® JIT RFCï¼Œå®æ—¶ç¼–è¯‘å™¨çš„å®ç°åº”è¯¥å¯ä»¥æé«˜ PHP çš„æ€§èƒ½ã€‚ä½†æ˜¯æˆ‘ä»¬çœŸçš„ä¼šåœ¨åƒ WordPress è¿™æ ·çš„ç°å®ç”Ÿæ´»åº”ç”¨ä¸­ä½“éªŒåˆ°è¿™æ ·çš„æ”¹è¿›å—ï¼Ÿ

æ—©æœŸæµ‹è¯•è¡¨æ˜ï¼ŒJIT å°†ä½¿ CPU å¯†é›†å‹å·¥ä½œè´Ÿè½½è¿è¡Œå¾—æ›´å¿«ã€‚[ç„¶è€Œï¼ŒRFC è­¦å‘Š](https://wiki.php.net/rfc/jit#performance):

> â€œâ€¦â€¦å°±åƒä»¥å‰çš„å°è¯•ä¸€æ ·â€”â€”å®ƒç›®å‰ä¼¼ä¹æ²¡æœ‰æ˜¾è‘—æ”¹å–„ WordPress ç­‰ç°å®ç”Ÿæ´»ä¸­çš„åº”ç”¨ç¨‹åº(op cache . JIT = 1235 326 req/sec vs . 315 req/sec)ã€‚
> 
> å®ƒè®¡åˆ’æä¾›é¢å¤–çš„åŠªåŠ›ï¼Œæ”¹å–„ç°å®ç”Ÿæ´»ä¸­åº”ç”¨ç¨‹åºçš„ JITï¼Œä½¿ç”¨å‰–æå’Œæ¨æµ‹æ€§ä¼˜åŒ–ã€‚"

å¯ç”¨ JIT åï¼Œä»£ç å°†ä¸ä¼šç”± Zend VM è¿è¡Œï¼Œè€Œæ˜¯ç”± CPU æœ¬èº«è¿è¡Œï¼Œè¿™å°†æé«˜è®¡ç®—é€Ÿåº¦ã€‚åƒ [WordPress](https://kinsta.com/knowledgebase/what-is-wordpress/) è¿™æ ·çš„ç½‘ç»œåº”ç”¨ä¹Ÿä¾èµ–äºå…¶ä»–å› ç´ ï¼Œå¦‚ [TTFB](https://kinsta.com/blog/ttfb/) ã€[æ•°æ®åº“ä¼˜åŒ–](https://kinsta.com/knowledgebase/wordpress-repair-database/)ã€ [HTTP è¯·æ±‚](https://kinsta.com/learn/what-is-http2/)ç­‰ã€‚

![PHP 8 performance diagram](img/b8274a140a4e0c95c61797497368923a.png)

Relative JIT contribution to PHP 8 performance (Image source: [PHP 8.0 Announcement Addendum](https://www.php.net/releases/8.0/en.php))



æ‰€ä»¥ï¼Œæˆ‘ä»¬ä¸åº”è¯¥æœŸæœ›åœ¨ WordPress å’Œç±»ä¼¼çš„åº”ç”¨ä¸Š PHP çš„æ‰§è¡Œé€Ÿåº¦ä¼šæœ‰æ˜¾è‘—çš„æå‡ã€‚ç„¶è€Œï¼ŒJIT å¯ä»¥ä¸ºå¼€å‘è€…å¸¦æ¥å‡ ä¸ªå¥½å¤„ã€‚

[æ®å°¼åŸºå¡”Â·æ³¢æ³¢å¤«](https://externals.io/message/103903#103927):

> â€œJIT ç¼–è¯‘å™¨çš„å¥½å¤„å¤§è‡´å¦‚ä¸‹(å¦‚ RFC ä¸­æ‰€è¿°):
> 
> *   æ•°å­—ä»£ç çš„æ€§èƒ½æ˜¾è‘—æé«˜ã€‚
> *   â€œå…¸å‹â€PHP web åº”ç”¨ç¨‹åºä»£ç çš„æ€§èƒ½ç¨å¥½ã€‚
> *   å°†æ›´å¤šä»£ç ä» C è½¬ç§»åˆ° PHP çš„æ½œåŠ›ï¼Œå› ä¸º PHP ç°åœ¨å·²ç»è¶³å¤Ÿå¿«äº†ã€‚"

å› æ­¤ï¼Œå°½ç®¡ JIT å¾ˆéš¾ç»™ WordPress çš„æ€§èƒ½å¸¦æ¥å·¨å¤§çš„æ”¹è¿›ï¼Œä½†å®ƒå°† PHP å‡çº§åˆ°ä¸€ä¸ªæ–°çš„æ°´å¹³ï¼Œä½¿å®ƒæˆä¸ºä¸€ç§å¯ä»¥ç›´æ¥ç¼–å†™è®¸å¤šå‡½æ•°çš„è¯­è¨€ã€‚

ä¸åˆ©çš„ä¸€é¢æ˜¯æ›´å¤§çš„å¤æ‚æ€§ï¼Œè¿™ä¼šå¢åŠ ç»´æŠ¤æˆæœ¬ã€ç¨³å®šæ€§å’Œ T2 è°ƒè¯•æˆæœ¬ã€‚æ ¹æ®å¾·ç±³ç‰¹é‡ŒÂ·æ–¯æ‰˜æˆˆå¤«çš„è¯´æ³•:

> â€œJIT éå¸¸ç®€å•ï¼Œä½†æ— è®ºå¦‚ä½•ï¼Œå®ƒå¢åŠ äº†æ•´ä¸ª PHP çš„å¤æ‚æ€§ï¼Œæ–°ç±»å‹é”™è¯¯çš„é£é™©ä»¥åŠå¼€å‘å’Œç»´æŠ¤çš„æˆæœ¬ã€‚â€

åœ¨ PHP 8 ä¸­åŒ…å« JIT çš„ææ¡ˆä»¥ 50 æ¯” 2 çš„ç¥¨æ•°é€šè¿‡ã€‚

[PHP 8 æ¥äº†ï¼ğŸš€è¯·æŸ¥çœ‹æˆ‘ä»¬å¯¹æ–°åŠŸèƒ½çš„æ·±å…¥äº†è§£ï¼ ç‚¹å‡»æ¨æ–‡](https://twitter.com/intent/tweet?url=https%3A%2F%2Fkinsta.com%2Fblog%2Fphp-8%2F&via=kinsta&text=PHP+8+is+here%21+%F0%9F%9A%80+Check+out+our+deep+dive+into+the+new+features%21&hashtags=PHP%2Cwebdev)


## PHP 8 çš„æ”¹è¿›å’Œæ–°ç‰¹æ€§

é™¤äº† JITï¼Œæˆ‘ä»¬å¯ä»¥æœŸå¾… PHP 8 çš„è®¸å¤šç‰¹æ€§å’Œæ”¹è¿›ã€‚ä¸‹é¢çš„åˆ—è¡¨æ˜¯æˆ‘ä»¬ç²¾å¿ƒæŒ‘é€‰çš„å³å°†åˆ°æ¥çš„å¢åŠ å’Œæ”¹å˜ï¼Œå®ƒä»¬å°†ä½¿ PHP æ›´åŠ å¯é å’Œé«˜æ•ˆã€‚

### æ„é€ å‡½æ•°å±æ€§æå‡

ä½œä¸ºæ­£åœ¨è¿›è¡Œçš„å…³äºåœ¨ PHP ä¸­æ”¹è¿›[å¯¹è±¡äººæœºå·¥ç¨‹å­¦çš„è®¨è®ºçš„ç»“æœï¼Œ](https://hive.blog/php/@crell/improving-php-s-object-ergonomics)[æ„é€ å‡½æ•°å±æ€§æå‡ RFC](https://wiki.php.net/rfc/constructor_promotion) æå‡ºäº†ä¸€ç§æ–°çš„æ›´ç®€æ´çš„è¯­æ³•ï¼Œå®ƒå°†ç®€åŒ–å±æ€§å£°æ˜ï¼Œä½¿å…¶æ›´çŸ­ã€æ›´å°‘å†—ä½™ã€‚

è¯¥å»ºè®®ä»…æ¶‰åŠ**æå‡å‚æ•°**ï¼Œå³é‚£äº›ä»¥**å…¬å…±**ã€**ä¿æŠ¤**å’Œ**ç§æœ‰**å¯è§æ€§å…³é”®å­—ä¸ºå‰ç¼€çš„æ–¹æ³•å‚æ•°ã€‚

ç›®å‰ï¼Œæ‰€æœ‰çš„å±æ€§éƒ½å¿…é¡»é‡å¤å‡ æ¬¡(è‡³å°‘å››æ¬¡)æ‰èƒ½ç”¨äºå¯¹è±¡ã€‚è€ƒè™‘æ¥è‡ª RFC çš„ä»¥ä¸‹ç¤ºä¾‹:

```
class Point {
    public int $x;
    public int $y;
    public int $z;

    public function __construct(
        int $x = 0,
        int $y = 0,
        int $z = 0,
    ) {
        $this->x = $x;
        $this->y = $y;
        $this->z = $z;
    }
}
```

æ ¹æ® RFC ä½œè€… Nikita Popov çš„è¯´æ³•ï¼Œæˆ‘ä»¬å¿…é¡»åœ¨ä¸‰ä¸ªä¸åŒçš„åœ°æ–¹è‡³å°‘å†™å››æ¬¡å±æ€§å:å±æ€§å£°æ˜ã€æ„é€ å‡½æ•°å‚æ•°å’Œå±æ€§èµ‹å€¼ã€‚è¿™ç§è¯­æ³•ä¸æ˜¯ç‰¹åˆ«æœ‰ç”¨ï¼Œå°¤å…¶æ˜¯åœ¨å…·æœ‰è®¸å¤šå±æ€§å’Œæ›´å¤šæè¿°æ€§åç§°çš„ç±»ä¸­ã€‚

è¿™ä¸ª RFC å»ºè®®åˆå¹¶æ„é€ å‡½æ•°å’Œå‚æ•°å®šä¹‰ã€‚å› æ­¤ï¼Œä» PHP 8 å¼€å§‹ï¼Œæˆ‘ä»¬æœ‰äº†ä¸€ç§æ›´æœ‰ç”¨çš„å£°æ˜å‚æ•°çš„æ–¹å¼ã€‚ä¸Šé¢çœ‹åˆ°çš„ä»£ç å¯ä»¥å¦‚ä¸‹æ‰€ç¤ºè¿›è¡Œæ›´æ”¹:

```
class Point {
    public function __construct(
        public int $x = 0,
        public int $y = 0,
        public int $z = 0,
    ) {}
}
```

ä»…æ­¤è€Œå·²ã€‚å› æ­¤ï¼Œæˆ‘ä»¬æœ‰äº†ä¸€ç§æ–°çš„æ–¹æ³•æ¥æå‡æ›´çŸ­ã€æ›´æ˜“è¯»ã€æ›´ä¸å®¹æ˜“å‡ºé”™çš„å±æ€§ã€‚[æ®å°¼åŸºå¡”](https://phpinternals.news/53):

> è¿™æ˜¯æˆ‘ä»¬æ­£åœ¨åšçš„ä¸€ä¸ªç®€å•çš„å¥æ³•è½¬æ¢ã€‚ä½†æ˜¯è¿™å‡å°‘äº†æ‚¨å¿…é¡»ä¸ºå€¼å¯¹è±¡ç¼–å†™çš„æ ·æ¿ä»£ç çš„æ•°é‡â€¦

å±æ€§å£°æ˜è¢«è½¬æ¢ä¸ºæˆ‘ä»¬æ˜¾å¼å£°æ˜çš„é‚£äº›å±æ€§ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨[åå°„ API](https://www.php.net/manual/en/intro.reflection.php) åœ¨æ‰§è¡Œå‰è‡ªçœå±æ€§å®šä¹‰(å‚è§[å»ç³–](https://wiki.php.net/rfc/constructor_promotion#desugaring)):

> åå°„(å’Œå…¶ä»–å†…çœæœºåˆ¶)ä¼šè§‚å¯Ÿå»ç³–åçš„çŠ¶æ€ã€‚è¿™æ„å‘³ç€æå‡çš„å±æ€§å°†ä»¥ä¸æ˜¾å¼å£°æ˜çš„å±æ€§ç›¸åŒçš„æ–¹å¼å‡ºç°ï¼Œè€Œæå‡çš„æ„é€ å‡½æ•°å‚æ•°å°†ä»¥æ™®é€šæ„é€ å‡½æ•°å‚æ•°çš„å½¢å¼å‡ºç°ã€‚

```
// before desugaring
class Point {
    public function __construct(public int $x = 0) {}
}

// after desugaring
class Point {
    public int $x;

    public function __construct(int $x = 0) {
        $this->x = $x;
    }
}
```

#### é—äº§

æˆ‘ä»¬åœ¨ç»“åˆæå‡å‚æ•°ä½¿ç”¨ç»§æ‰¿æ—¶æ²¡æœ‰ä»»ä½•é™åˆ¶ã€‚æ— è®ºå¦‚ä½•ï¼Œçˆ¶ç±»æ„é€ å‡½æ•°å’Œå­ç±»æ„é€ å‡½æ•°ä¹‹é—´æ²¡æœ‰ç‰¹å®šçš„å…³ç³»ã€‚[æ®å°¼åŸºå¡”](https://phpinternals.news/53):

> é€šå¸¸ï¼Œæˆ‘ä»¬è¯´æ–¹æ³•æ€»æ˜¯å¿…é¡»ä¸çˆ¶æ–¹æ³•å…¼å®¹ã€‚[â€¦â€¦]ä½†æ˜¯è¿™ä¸ªè§„åˆ™å¹¶ä¸é€‚ç”¨äºæ„é€ å‡½æ•°ã€‚å› æ­¤ï¼Œæ„é€ å‡½æ•°å®é™…ä¸Šå±äºä¸€ä¸ªç±»ï¼Œçˆ¶ç±»å’Œå­ç±»ä¹‹é—´çš„æ„é€ å‡½æ•°ä¸å¿…ä»¥ä»»ä½•æ–¹å¼å…¼å®¹ã€‚

è¿™é‡Œæœ‰ä¸€ä¸ªä¾‹å­:

```
class Test {
    public function __construct(
        public int $x = 0
    ) {}
}

class Child extends Test {
    public function __construct(
        $x, 
        public int $y = 0,
        public int $z = 0,
    ) {
        parent::__construct($x);
    }
}
```

#### æå‡çš„å±æ€§ä¸å…è®¸ä»€ä¹ˆ

éæŠ½è±¡æ„é€ å‡½æ•°å’Œç‰¹å¾ä¸­å…è®¸æå‡å±æ€§ï¼Œä½†æ˜¯è¿™é‡Œæœ‰å‡ ä¸ªé™åˆ¶å€¼å¾—ä¸€æã€‚

##### æŠ½è±¡æ„é€ å‡½æ•°

æŠ½è±¡ç±»å’Œæ¥å£ä¸­ä¸å…è®¸æå‡çš„å±æ€§:

```
abstract class Test {
    // Error: Abstract constructor.
    abstract public function __construct(private $x);
}

interface Test {
    // Error: Abstract constructor.
    public function __construct(private $x);
}
```

##### å¯ç©ºæ€§

æœ€æ˜¾è‘—çš„çº¦æŸä¹‹ä¸€ä¸å¯ç©ºæ€§æœ‰å…³ã€‚ä»¥å‰ï¼Œæˆ‘ä»¬ä½¿ç”¨çš„æ˜¯ä¸å¯æ˜¾å¼ä¸ºç©ºçš„ç±»å‹ã€‚ä½†æ˜¯å¦‚æœç¼ºçœå€¼ä¸ºç©ºï¼Œåˆ™è¯¥ç±»å‹å¯ä»¥éšå¼ä¸ºç©ºã€‚ä½†æ˜¯å¯¹äºå±æ€§ç±»å‹ï¼Œæˆ‘ä»¬æ²¡æœ‰è¿™ç§éšå¼è¡Œä¸ºï¼Œå› ä¸ºæå‡çš„å‚æ•°éœ€è¦å±æ€§å£°æ˜ï¼Œå¹¶ä¸”å¯ç©ºç±»å‹å¿…é¡»æ˜¾å¼å£°æ˜ã€‚è¯·å‚è§ RFC ä¸­çš„ä»¥ä¸‹ç¤ºä¾‹:

```
class Test {
    // Error: Using null default on non-nullable property
    public function __construct(public Type $prop = null) {}

    // Correct: Make the type explicitly nullable instead
    public function __construct(public ?Type $prop = null) {}
}
```

##### å¯è°ƒç”¨ç±»å‹

ç”±äº callable ä¸æ˜¯å±æ€§çš„[æ”¯æŒçš„ç±»å‹ï¼Œæˆ‘ä»¬ä¸å…è®¸åœ¨æå‡çš„å±æ€§ä¸­ä½¿ç”¨ callable ç±»å‹:](https://kinsta.com/blog/php-7-4/#typed-properties)

```
class Test {
    // Error: Callable type not supported for properties.
    public function __construct(public callable $callback) {}
}
```

##### ä¸å…è®¸ä½¿ç”¨ var å…³é”®å­—

åªæœ‰ visibility å…³é”®å­—å¯ä»¥ç”¨äºæå‡çš„å‚æ•°ï¼Œå› æ­¤ä¸å…è®¸ç”¨`var`å…³é”®å­—å£°æ˜æ„é€ å‡½æ•°å±æ€§(å‚è§ RFC ä¸­çš„ä»¥ä¸‹ç¤ºä¾‹):

```
class Test {
    // Error: "var" keyword is not supported.
    public function __construct(var $prop) {}
}
```

##### ä¸å…è®¸é‡å¤

æˆ‘ä»¬å¯ä»¥åœ¨åŒä¸€ä¸ªç±»ä¸­ç»„åˆæå‡å±æ€§å’Œæ˜¾å¼å±æ€§ï¼Œä½†æ˜¯å±æ€§ä¸èƒ½å£°æ˜ä¸¤æ¬¡:

```
class Test {
    public string $prop;
    public int $explicitProp;

    // Correct
    public function __construct(public int $promotedProp, int $arg) {
        $this->explicitProp = $arg;
    }

    // Error: Redeclaration of property.
    public function __construct(public string $prop) {}
}
```

##### ä¸å…è®¸å˜é‡å‚æ•°

è¿™é‡Œçš„åŸå› æ˜¯å£°æ˜çš„ç±»å‹ä¸åŒäºå˜é‡å‚æ•°ï¼Œå˜é‡å‚æ•°å®é™…ä¸Šæ˜¯ä¸€ä¸ªæ•°ç»„:

```
class Test {
    // Error: Variadic parameter.
    public function __construct(public string ...$strings) {}
}
```

#### è¿›ä¸€æ­¥é˜…è¯»

ä¸ºäº†æ›´è¿‘è·ç¦»åœ°äº†è§£å»ºç­‘å•†åœ°äº§æ¨å¹¿ï¼Œè¯·å¬å¬å°¼åŸºå¡”Â·æ³¢æ³¢å¤«çš„é‡‡è®¿ã€‚è¦æ·±å…¥äº†è§£ PHP ä¸­çš„å¯¹è±¡äººä½“å·¥ç¨‹å­¦ï¼Œè¯·çœ‹[è¿™ç¯‡æ–‡ç« ](https://hive.blog/php/@crell/improving-php-s-object-ergonomics)å’Œä¸‹é¢çš„[å¯¹æ‹‰é‡ŒÂ·åŠ è²å°”å¾·çš„é‡‡è®¿](https://phpinternals.news/51)ã€‚

### æŠ½è±¡ç‰¹å¾æ–¹æ³•çš„éªŒè¯

[Traits](https://www.php.net/manual/en/language.oop5.traits.php) è¢«å®šä¹‰ä¸ºâ€œPHP ç­‰å•ä¸€ç»§æ‰¿è¯­è¨€ä¸­çš„ä»£ç é‡ç”¨æœºåˆ¶ã€‚â€é€šå¸¸ï¼Œå®ƒä»¬ç”¨äºå£°æ˜å¯åœ¨å¤šä¸ªç±»ä¸­ä½¿ç”¨çš„æ–¹æ³•ã€‚

ç‰¹å¾ä¹Ÿå¯ä»¥åŒ…å«æŠ½è±¡æ–¹æ³•ã€‚è¿™äº›æ–¹æ³•åªæ˜¯å£°æ˜æ–¹æ³•çš„ç­¾åï¼Œä½†æ˜¯æ–¹æ³•çš„å®ç°å¿…é¡»åœ¨ä½¿ç”¨ trait çš„ç±»ä¸­å®Œæˆã€‚

æ ¹æ® [PHP æ‰‹å†Œ](https://www.php.net/manual/en/language.oop5.traits.php#language.oop5.traits.abstract)ï¼Œ

> "ç‰¹å¾æ”¯æŒä½¿ç”¨æŠ½è±¡æ–¹æ³•ï¼Œä»¥ä¾¿å¯¹å±•ç¤ºç±»æ–½åŠ è¦æ±‚."

è¿™ä¹Ÿæ„å‘³ç€æ–¹æ³•çš„ç­¾åå¿…é¡»åŒ¹é…ã€‚æ¢å¥è¯è¯´ï¼Œæ‰€éœ€å‚æ•°çš„ç±»å‹å’Œæ•°é‡éœ€è¦ç›¸åŒã€‚

æ€»ä¹‹ï¼Œ[æ ¹æ® RFC çš„ä½œè€…å°¼åŸºå¡”Â·æ³¢æ³¢å¤«](https://externals.io/message/108065#108164)çš„è¯´æ³•ï¼Œç­¾åéªŒè¯ç›®å‰åªæ˜¯æ–­æ–­ç»­ç»­åœ°å®æ–½:

> *   In most cases, it is not mandatory, and the method implementation is provided by the usage class:
> *   If the implementation comes from the parent class, force:
> *   If the implementation comes from a subclass, force:

Nikita çš„ä»¥ä¸‹ç¤ºä¾‹ä¸ç¬¬ä¸€ç§æƒ…å†µæœ‰å…³(éå¼ºåˆ¶ç­¾å):

```
trait T {
	abstract public function test(int $x);
}

class C {
	use T;

	// Allowed, but shouldn't be due to invalid type.
	public function test(string $x) {}
}
```

ä¹Ÿå°±æ˜¯è¯´ï¼Œ[è¿™ä¸ª RFC](https://wiki.php.net/rfc/abstract_trait_method_validation) å»ºè®®ï¼Œå¦‚æœå®ç°æ–¹æ³•ä¸æŠ½è±¡ç‰¹å¾æ–¹æ³•ä¸å…¼å®¹ï¼Œæ— è®ºå…¶æ¥æºå¦‚ä½•ï¼Œæ€»æ˜¯æŠ›å‡ºè‡´å‘½é”™è¯¯:

```
Fatal error: Declaration of C::test(string $x) must be compatible with T::test(int $x) in /path/to/your/test.php on line 10
```

æ­¤ RFC å·²è·å¾—ä¸€è‡´æ‰¹å‡†ã€‚

### ä¸å…¼å®¹çš„æ–¹æ³•ç­¾å

åœ¨ PHP ä¸­ï¼Œç”±äºä¸å…¼å®¹çš„æ–¹æ³•ç­¾åå¯¼è‡´çš„ç»§æ‰¿é”™è¯¯è¦ä¹ˆæŠ›å‡ºè‡´å‘½é”™è¯¯ï¼Œè¦ä¹ˆæŠ›å‡ºè­¦å‘Šï¼Œè¿™å–å†³äºå¯¼è‡´é”™è¯¯çš„åŸå› ã€‚

å¦‚æœä¸€ä¸ªç±»æ­£åœ¨å®ç°ä¸€ä¸ªæ¥å£ï¼Œä¸å…¼å®¹çš„æ–¹æ³•ç­¾åå°†å¼•å‘è‡´å‘½é”™è¯¯ã€‚æ ¹æ®[å¯¹è±¡æ¥å£æ–‡æ¡£](https://www.php.net/manual/en/language.oop5.interfaces.php):

> å®ç°æ¥å£çš„ç±»å¿…é¡»ä½¿ç”¨ä¸ LSP (Liskov æ›¿æ¢åŸåˆ™)å…¼å®¹çš„æ–¹æ³•ç­¾åã€‚å¦åˆ™å°†å¯¼è‡´è‡´å‘½é”™è¯¯ã€‚

ä¸‹é¢æ˜¯ä¸€ä¸ªæ¥å£çš„[ç»§æ‰¿é”™è¯¯çš„ä¾‹å­:](https://wiki.php.net/rfc/lsp_errors)

```
interface I {
	public function method(array $a);
}
class C implements I {
	public function method(int $a) {}
}
```

åœ¨ PHP 7.4 ä¸­ï¼Œä¸Šé¢çš„ä»£ç ä¼šæŠ›å‡ºä»¥ä¸‹é”™è¯¯:

```
Fatal error: Declaration of C::method(int $a) must be compatible with I::method(array $a) in /path/to/your/test.php on line 7
```

å…·æœ‰ä¸å…¼å®¹ç­¾åçš„å­ç±»ä¸­çš„å‡½æ•°å°†æŠ›å‡ºè­¦å‘Šã€‚è¯·å‚è§æ¥è‡ª RFC çš„ä»¥ä¸‹ä»£ç :

```
class C1 {
	public function method(array $a) {}
}
class C2 extends C1 {
	public function method(int $a) {}
}
```

åœ¨ PHP 7.4 ä¸­ï¼Œä¸Šé¢çš„ä»£ç åªä¼šæŠ›å‡ºä¸€ä¸ªè­¦å‘Š:

```
Warning: Declaration of C2::method(int $a) should be compatible with C1::method(array $a) in /path/to/your/test.php on line 7
```

ç°åœ¨ï¼Œ[è¿™ä¸ª RFC](https://wiki.php.net/rfc/lsp_errors) å»ºè®®å¯¹äºä¸å…¼å®¹çš„æ–¹æ³•ç­¾åæ€»æ˜¯æŠ›å‡ºä¸€ä¸ªè‡´å‘½é”™è¯¯ã€‚å¯¹äº PHP 8ï¼Œæˆ‘ä»¬å‰é¢çœ‹åˆ°çš„ä»£ç ä¼šæç¤ºå¦‚ä¸‹:

```
Fatal error: Declaration of C2::method(int $a) must be compatible with C1::method(array $a) in /path/to/your/test.php on line 7
```

### ä»è´Ÿç´¢å¼•å¼€å§‹çš„æ•°ç»„

åœ¨ PHP ä¸­ï¼Œå¦‚æœä¸€ä¸ªæ•°ç»„ä»¥ä¸€ä¸ªè´Ÿçš„ç´¢å¼•(`start_index < 0`)å¼€å§‹ï¼Œåé¢çš„ç´¢å¼•å°†ä» 0 å¼€å§‹(åœ¨ [`array_fill`æ–‡æ¡£](https://www.php.net/manual/en/function.array-fill.php)ä¸­æœ‰æ›´å¤šå…³äºè¿™ä¸ªçš„å†…å®¹)ã€‚è¯·çœ‹ä¸‹é¢çš„ä¾‹å­:

```
$a = array_fill(-5, 4, true);
var_dump($a);
```

åœ¨ PHP 7.4 ä¸­ï¼Œç»“æœå¦‚ä¸‹:

```
array(4) {
	[-5]=>
	bool(true)
	[0]=>
	bool(true)
	[1]=>
	bool(true)
	[2]=>
	bool(true)
}
```

ç°åœ¨ï¼Œ[è¿™ä¸ª RFC](https://wiki.php.net/rfc/negative_array_index) æè®®æ”¹å˜äº‹æƒ…ï¼Œè¿™æ ·ç¬¬äºŒä¸ªç´¢å¼•å°†æ˜¯`start_index + 1`ï¼Œæ— è®º`start_index`çš„å€¼æ˜¯ä»€ä¹ˆã€‚

åœ¨ PHP 8 ä¸­ï¼Œä¸Šé¢çš„ä»£ç ä¼šäº§ç”Ÿä¸‹é¢çš„æ•°ç»„:

```
array(4) {
	[-5]=>
	bool(true)
	[-4]=>
	bool(true)
	[-3]=>
	bool(true)
	[-2]=>
	bool(true)
}
```

åœ¨ PHP 8 ä¸­ï¼Œä»¥è´Ÿç´¢å¼•å¼€å§‹çš„æ•°ç»„ä¼šæ”¹å˜å®ƒä»¬çš„è¡Œä¸ºã€‚åœ¨ RFC ä¸­é˜…è¯»æ›´å¤šå…³äºå‘åä¸å…¼å®¹çš„å†…å®¹ã€‚

### è”åˆç±»å‹ 2.0

[è”åˆç±»å‹](https://en.wikipedia.org/wiki/Union_type)æ¥å—ä¸åŒç±»å‹çš„å€¼ã€‚ç›®å‰ï¼ŒPHP ä¸æ”¯æŒè”åˆç±»å‹ï¼Œé™¤äº†`?Type`è¯­æ³•å’Œç‰¹æ®Šçš„`iterable`ç±»å‹ã€‚

åœ¨ PHP 8 ä¹‹å‰ï¼Œè”åˆç±»å‹åªèƒ½åœ¨ phpdoc æ³¨é‡Šä¸­æŒ‡å®š[ï¼Œå¦‚ RFC ä¸­çš„ä»¥ä¸‹ç¤ºä¾‹æ‰€ç¤º:](https://docs.phpdoc.org/latest/guides/types.html#multiple-types-combined)

```
class Number {
	/**
	 * @var int|float $number
	 */
	private $number;

	/**
	 * @param int|float $number
	 */
	public function setNumber($number) {
		$this->number = $number;
	}

	/**
	 * @return int|float
	 */
	public function getNumber() {
		return $this->number;
	}
}
```

ç°åœ¨ï¼Œ[Union types 2.0 RFC](https://wiki.php.net/rfc/union_types_v2)æè®®åœ¨å‡½æ•°ç­¾åä¸­å¢åŠ å¯¹è”åˆç±»å‹çš„æ”¯æŒï¼Œè¿™æ ·æˆ‘ä»¬å°±ä¸å†ä¾èµ–[å†…è”æ–‡æ¡£](https://docs.phpdoc.org/latest/guide/getting-started/your-first-set-of-documentation.html)ï¼Œè€Œæ˜¯ç”¨`T1|T2|...`è¯­æ³•å®šä¹‰è”åˆç±»å‹:

```
class Number {
	private int|float $number;

	public function setNumber(int|float $number): void {
		$this->number = $number;
	}

	public function getNumber(): int|float {
		return $this->number;
	}
}
```

æ­£å¦‚å°¼åŸºå¡”Â·æ³¢æ³¢å¤«åœ¨ RFC ä¸­è§£é‡Šçš„é‚£æ ·ï¼Œ

> â€œè¯­è¨€ä¸­å¯¹è”åˆç±»å‹çš„æ”¯æŒå…è®¸æˆ‘ä»¬å°†æ›´å¤šçš„ç±»å‹ä¿¡æ¯ä» phpdoc è½¬ç§»åˆ°å‡½æ•°ç­¾åä¸­ï¼Œè¿™é€šå¸¸ä¼šå¸¦æ¥ä»¥ä¸‹å¥½å¤„:
> 
> *   ç±»å‹å®é™…ä¸Šæ˜¯å¼ºåˆ¶æ‰§è¡Œçš„ï¼Œå› æ­¤å¯ä»¥åŠæ—©å‘ç°é”™è¯¯ã€‚
> *   å› ä¸ºå®ƒä»¬æ˜¯å¼ºåˆ¶çš„ï¼Œæ‰€ä»¥ç±»å‹ä¿¡æ¯ä¸å¤ªå¯èƒ½å˜å¾—è¿‡æ—¶æˆ–é”™è¿‡è¾¹ç¼˜æƒ…å†µã€‚
> *   åœ¨ç»§æ‰¿è¿‡ç¨‹ä¸­æ£€æŸ¥ç±»å‹ï¼Œæ‰§è¡Œ Liskov æ›¿æ¢åŸåˆ™ã€‚
> *   é€šè¿‡åå°„å¯ä»¥è·å¾—ç±»å‹ã€‚
> *   è¯­æ³•æ¯” phpdoc å°‘äº†å¾ˆå¤šæ ·æ¿ã€‚"

è”åˆç±»å‹æ”¯æŒæ‰€æœ‰å¯ç”¨çš„ç±»å‹ï¼Œä½†æœ‰ä¸€äº›é™åˆ¶:

*   ç±»å‹`void`ä¸èƒ½æ˜¯è”åˆçš„ä¸€éƒ¨åˆ†ï¼Œå› ä¸º`void`æ„å‘³ç€å‡½æ•°[ä¸è¿”å›ä»»ä½•å€¼](https://wiki.php.net/rfc/void_return_type)ã€‚
*   `null`ç±»å‹ä»…åœ¨è”åˆç±»å‹ä¸­å—æ”¯æŒï¼Œä½†ä¸å…è®¸å°†å…¶ç”¨ä½œç‹¬ç«‹ç±»å‹ã€‚
*   å¯ç©ºç±»å‹ç¬¦å·(`?T`)ä¹Ÿæ˜¯å…è®¸çš„ï¼Œæ„æ€æ˜¯`T|null`ï¼Œä½†æ˜¯æˆ‘ä»¬ä¸å…è®¸åœ¨è”åˆç±»å‹ä¸­åŒ…å«`?T`ç¬¦å·(`?T1|T2`æ˜¯ä¸å…è®¸çš„ï¼Œæˆ‘ä»¬åº”è¯¥ä½¿ç”¨`T1|T2|null`)ã€‚
*   å°½å¯èƒ½å¤šçš„åŠŸèƒ½(å³`strpos()`ã€`strstr()`ã€`substr()`ç­‰)ã€‚)åœ¨å¯èƒ½çš„è¿”å›ç±»å‹ä¸­åŒ…å«`false`ï¼Œä¹Ÿæ”¯æŒ`false`ä¼ªç±»å‹ã€‚

ä½ å¯ä»¥åœ¨ RFC ä¸­é˜…è¯»æ›´å¤šå…³äºè”ç›Ÿç±»å‹ V2 çš„ä¿¡æ¯ã€‚

### å†…éƒ¨å‡½æ•°çš„ä¸€è‡´ç±»å‹é”™è¯¯

å½“ä¼ é€’éæ³•ç±»å‹çš„å‚æ•°æ—¶ï¼Œ[å†…éƒ¨](https://www.php.net/manual/en/functions.internal.php)å’Œ[ç”¨æˆ·è‡ªå®šä¹‰](https://www.php.net/manual/en/functions.user-defined.php)å‡½æ•°è¡¨ç°ä¸åŒã€‚

ç”¨æˆ·å®šä¹‰çš„å‡½æ•°æŠ›å‡ºä¸€ä¸ª`TypeError`ï¼Œä½†æ˜¯å†…éƒ¨å‡½æ•°æœ‰ä¸åŒçš„è¡Œä¸ºæ–¹å¼ï¼Œè¿™å–å†³äºå‡ ä¸ªæ¡ä»¶ã€‚åæ­£å…¸å‹çš„è¡Œä¸ºå°±æ˜¯æŠ›å‡ºè­¦å‘Šè¿”å›`null`ã€‚è¯·å‚è§ PHP 7.4 ä¸­çš„ä»¥ä¸‹ç¤ºä¾‹:

```
var_dump(strlen(new stdClass));
```

è¿™å°†å¯¼è‡´ä»¥ä¸‹è­¦å‘Š:

```
Warning: strlen() expects parameter 1 to be string, object given in /path/to/your/test.php on line 4
NULL
```

å¦‚æœå¯ç”¨äº†`strict_types`,æˆ–è€…å‚æ•°ä¿¡æ¯æŒ‡å®šäº†ç±»å‹ï¼Œé‚£ä¹ˆè¡Œä¸ºä¼šæœ‰æ‰€ä¸åŒã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œç±»å‹é”™è¯¯è¢«æ£€æµ‹åˆ°å¹¶å¯¼è‡´ä¸€ä¸ª`TypeError`ã€‚

è¿™ç§æƒ…å†µä¼šå¯¼è‡´è®¸å¤šé—®é¢˜ï¼Œè¿™äº›é—®é¢˜åœ¨ [RFC çš„é—®é¢˜ç« èŠ‚](https://wiki.php.net/rfc/consistent_type_errors#issues)ä¸­æœ‰å¾ˆå¥½çš„è§£é‡Šã€‚

ä¸ºäº†æ¶ˆé™¤è¿™äº›ä¸ä¸€è‡´ï¼Œ[è¿™ä¸ª RFC å»ºè®®](https://wiki.php.net/rfc/consistent_type_errors)è®©å†…éƒ¨å‚æ•°è§£æ API åœ¨å‚æ•°ç±»å‹ä¸åŒ¹é…çš„æƒ…å†µä¸‹æ€»æ˜¯ç”Ÿæˆä¸€ä¸ª`ThrowError`ã€‚

åœ¨ PHP 8 ä¸­ï¼Œä¸Šé¢çš„ä»£ç æŠ›å‡ºä»¥ä¸‹é”™è¯¯:

```
Fatal error: Uncaught TypeError: strlen(): Argument #1 ($str) must be of type string, object given in /path/to/your/test.php:4
Stack trace:
#0 {main}
  thrown in /path/to/your/test.php on line 4
```

### æŠ›å‡ºè¡¨è¾¾å¼

åœ¨ PHP ä¸­ï¼Œ`throw`æ˜¯ä¸€ä¸ª[è¯­å¥](https://www.php.net/manual/en/control-structures.intro.php)ï¼Œæ‰€ä»¥ä¸å¯èƒ½åœ¨åªå…è®¸ä½¿ç”¨[è¡¨è¾¾å¼](https://www.php.net/manual/en/language.expressions.php)çš„åœ°æ–¹ä½¿ç”¨å®ƒã€‚

## æ³¨å†Œè®¢é˜…æ—¶äº‹é€šè®¯



### æƒ³çŸ¥é“æˆ‘ä»¬æ˜¯æ€ä¹ˆè®©æµé‡å¢é•¿è¶…è¿‡ 1000%çš„å—ï¼Ÿ

åŠ å…¥ 20ï¼Œ000 å¤šåè·å¾—æˆ‘ä»¬æ¯å‘¨æ—¶äº‹é€šè®¯å’Œå†…éƒ¨æ¶ˆæ¯çš„äººçš„è¡Œåˆ—å§ï¼

[Subscribe Now](#newsletter)

[è¿™ä¸ª RFC](https://wiki.php.net/rfc/throw_expression) æå‡ºå°† [`throw`è¯­å¥](https://www.php.net/manual/en/language.exceptions.php)è½¬æ¢æˆä¸€ä¸ªè¡¨è¾¾å¼ï¼Œè¿™æ ·å®ƒå°±å¯ä»¥åœ¨ä»»ä½•å…è®¸è¡¨è¾¾å¼çš„ä¸Šä¸‹æ–‡ä¸­ä½¿ç”¨ã€‚æ¯”å¦‚[ç®­å¤´å‡½æ•°](https://kinsta.com/blog/php-7-4/#arrow-functions)ã€ [null coalesce è¿ç®—ç¬¦](https://wiki.php.net/rfc/isset_ternary)ã€[ä¸‰å…ƒå’Œ elvis è¿ç®—ç¬¦](https://www.php.net/manual/en/language.operators.comparison.php#language.operators.comparison.ternary)ç­‰ã€‚

å‚è§ RFC ä¸­çš„ä»¥ä¸‹ç¤ºä¾‹:

```
$callable = fn() => throw new Exception();

// $value is non-nullable.
$value = $nullableValue ?? throw new InvalidArgumentException();

// $value is truthy.
$value = $falsableValue ?: throw new InvalidArgumentException();
```

### å¼±æ˜ å°„

å¼±æ˜ å°„æ˜¯æ•°æ®(å¯¹è±¡)çš„é›†åˆï¼Œå…¶ä¸­é”®è¢«å¼±å¼•ç”¨ï¼Œè¿™æ„å‘³ç€å®ƒä»¬ä¸ä¼šè¢«é˜»æ­¢è¿›è¡Œåƒåœ¾æ”¶é›†ã€‚

PHP 7.4 å¢åŠ äº†å¯¹[å¼±å¼•ç”¨](https://kinsta.com/blog/php-7-4/#weakreferences)çš„æ”¯æŒï¼Œè¿™æ˜¯ä¸€ç§ä¿ç•™å¯¹è±¡å¼•ç”¨çš„æ–¹å¼ï¼Œä¸ä¼šé˜»æ­¢å¯¹è±¡æœ¬èº«è¢«é”€æ¯ã€‚æ­£å¦‚å°¼åŸºå¡”Â·æ³¢æ³¢å¤«æŒ‡å‡ºçš„é‚£æ ·ï¼Œ

> åŸå§‹å¼±å¼•ç”¨æœ¬èº«åªæœ‰æœ‰é™çš„ç”¨å¤„ï¼Œè€Œå¼±æ˜ å°„åœ¨å®è·µä¸­æ›´å¸¸ç”¨ã€‚ä¸å¯èƒ½åœ¨ PHP å¼±å¼•ç”¨ä¹‹ä¸Šå®ç°æœ‰æ•ˆçš„å¼±æ˜ å°„ï¼Œå› ä¸ºæ²¡æœ‰æä¾›æ³¨å†Œé”€æ¯å›è°ƒçš„èƒ½åŠ›ã€‚

è¿™å°±æ˜¯ä¸ºä»€ä¹ˆ[è¿™ä¸ª RFC](https://wiki.php.net/rfc/weak_maps) å¼•å…¥äº†ä¸€ä¸ª`WeakMap`ç±»æ¥åˆ›å»ºç”¨ä½œå¼±æ˜ å°„é”®çš„å¯¹è±¡ï¼Œå¦‚æœæ²¡æœ‰ä»»ä½•å¯¹é”®å¯¹è±¡çš„è¿›ä¸€æ­¥å¼•ç”¨ï¼Œè¿™äº›å¯¹è±¡å¯ä»¥è¢«é”€æ¯å¹¶ä»å¼±æ˜ å°„ä¸­åˆ é™¤ã€‚

åœ¨é•¿æ—¶é—´è¿è¡Œçš„æµç¨‹ä¸­ï¼Œè¿™å°†é˜²æ­¢å†…å­˜æ³„æ¼å¹¶æé«˜æ€§èƒ½ã€‚è¯·å‚è§ RFC ä¸­çš„ä»¥ä¸‹ç¤ºä¾‹:

```
$map = new WeakMap;
$obj = new stdClass;
$map[$obj] = 42;
var_dump($map);
```

ä½¿ç”¨ PHP 8ï¼Œä¸Šé¢çš„ä»£ç ä¼šäº§ç”Ÿä»¥ä¸‹ç»“æœ(å‚è§[è¿™é‡Œçš„ä»£ç è¿è¡Œ](https://3v4l.org/o6lZX/rfc#output)):

```
object(WeakMap)#1 (1) {
	[0]=>
	array(2) {
		["key"]=>
		object(stdClass)#2 (0) {
		}
		["value"]=>
		int(42)
	}
}
```

å¦‚æœå–æ¶ˆè®¾ç½®å¯¹è±¡ï¼Œè¯¥é”®å°†è‡ªåŠ¨ä»å¼±è´´å›¾ä¸­ç§»é™¤:

```
unset($obj);
var_dump($map);
```

ç°åœ¨ï¼Œç»“æœå°†å¦‚ä¸‹:

```
object(WeakMap)#1 (0) {
}
```

è¦æ›´ä»”ç»†åœ°æŸ¥çœ‹å¼±æ˜ å°„ï¼Œè¯·å‚è§ RFC ã€‚è¿™é¡¹æè®®è¢«ä¸€è‡´é€šè¿‡ã€‚

### å‚æ•°åˆ—è¡¨ä¸­çš„å°¾éšé€—å·

å°¾éšé€—å·æ˜¯é™„åŠ åˆ°ä¸åŒä¸Šä¸‹æ–‡ä¸­çš„é¡¹ç›®åˆ—è¡¨çš„é€—å·ã€‚PHP 7.2 åœ¨åˆ—è¡¨è¯­æ³•ä¸­å¼•å…¥äº†[å°¾éšé€—å·ï¼ŒPHP 7.3 åœ¨å‡½æ•°è°ƒç”¨](https://kinsta.com/blog/php-7-2/#trailing-commas-in-list-syntax)ä¸­å¼•å…¥äº†[å°¾éšé€—å·ã€‚](https://kinsta.com/blog/php-7-3/#trailing-comma-in-function-calls)

PHP 8 ç°åœ¨åœ¨å‡½æ•°ã€æ–¹æ³•å’Œé—­åŒ…çš„å‚æ•°åˆ—è¡¨ä¸­å¼•å…¥äº†å°¾éšé€—å·[ï¼Œå¦‚ä¸‹ä¾‹æ‰€ç¤º:](https://wiki.php.net/rfc/trailing_comma_in_parameter_list)

```
class Foo {
	public function __construct(
		string $x,
		int $y,
		float $z, // trailing comma
	) {
		// do something
	}
}
```

è¿™é¡¹ææ¡ˆä»¥ 58 ç¥¨å¯¹ 1 ç¥¨è·å¾—é€šè¿‡ã€‚

### å¯¹è±¡ä¸Šçš„ Allow ::class è¯­æ³•

è¦è·å–ç±»åï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨`Foo\Bar::class`è¯­æ³•ã€‚[è¿™ä¸ª RFC](https://wiki.php.net/rfc/class_name_literal_on_object) æè®®å°†ç›¸åŒçš„è¯­æ³•æ‰©å±•åˆ°å¯¹è±¡ï¼Œè¿™æ ·ç°åœ¨å°±å¯ä»¥è·å–ç»™å®šå¯¹è±¡çš„ç±»åï¼Œå¦‚ä¸‹ä¾‹æ‰€ç¤º:

```
$object = new stdClass;
var_dump($object::class); // "stdClass"

$object = null;
var_dump($object::class); // TypeError
```

åœ¨ PHP 8 ä¸­ï¼Œ`$object::class`æä¾›ä¸`get_class($object)`ç›¸åŒçš„ç»“æœã€‚å¦‚æœ`$object`ä¸æ˜¯ä¸€ä¸ªå¯¹è±¡ï¼Œå®ƒæŠ›å‡ºä¸€ä¸ª`TypeError`å¼‚å¸¸ã€‚

è¿™é¡¹æè®®è·å¾—ä¸€è‡´é€šè¿‡ã€‚

### å±æ€§ v2

å±æ€§ä¹Ÿç§°ä¸ºæ³¨é‡Šï¼Œæ˜¯ç»“æ„åŒ–çš„å…ƒæ•°æ®ï¼Œå¯ç”¨äºæŒ‡å®šå¯¹è±¡ã€å…ƒç´ æˆ–æ–‡ä»¶çš„å±æ€§ã€‚

åœ¨ PHP 7.4 ä¹‹å‰ï¼Œæ–‡æ¡£æ³¨é‡Šæ˜¯å‘ç±»ã€å‡½æ•°ç­‰å£°æ˜ä¸­æ·»åŠ å…ƒæ•°æ®çš„å”¯ä¸€æ–¹å¼ã€‚Attributes v2 RFC å¼•å…¥äº† PHP å±æ€§ï¼Œå°†å®ƒä»¬å®šä¹‰ä¸ºä¸€ç§ç»“æ„åŒ–çš„è¯­æ³•å…ƒæ•°æ®ï¼Œå¯ä»¥æ·»åŠ åˆ°ç±»ã€å±æ€§ã€å‡½æ•°ã€æ–¹æ³•ã€å‚æ•°å’Œå¸¸é‡çš„å£°æ˜ä¸­ã€‚

å±æ€§è¢«æ·»åŠ åˆ°å®ƒä»¬æ‰€å¼•ç”¨çš„å£°æ˜ä¹‹å‰ã€‚å‚è§ RFC ä¸­çš„ä»¥ä¸‹ç¤ºä¾‹:

```
<<ExampleAttribute>>
class Foo
{
	<<ExampleAttribute>>
	public const FOO = 'foo';

	<<ExampleAttribute>>
	public $x;

	<<ExampleAttribute>>
	public function foo(<<ExampleAttribute>> $bar) { }
}

$object = new <<ExampleAttribute>> class () { };

<<ExampleAttribute>>
function f1() { }

$f2 = <<ExampleAttribute>> function () { };

$f3 = <<ExampleAttribute>> fn () => 1;
```

å¯ä»¥åœ¨ doc-block æ³¨é‡Šä¹‹å‰æˆ–ä¹‹åæ·»åŠ å±æ€§:

```
<<ExampleAttribute>>
/** docblock */
<<AnotherExampleAttribute>>
function foo() {}
```

æ¯ä¸ªå£°æ˜å¯ä»¥æœ‰ä¸€ä¸ªæˆ–å¤šä¸ªå±æ€§ï¼Œæ¯ä¸ªå±æ€§å¯ä»¥æœ‰ä¸€ä¸ªæˆ–å¤šä¸ªå…³è”å€¼:

```
<<WithoutArgument>>
<<SingleArgument(0)>>
<<FewArguments('Hello', 'World')>>
function foo() {}
```

å‚è§ [RFC](https://wiki.php.net/rfc/attributes_v2) ä»¥è·å¾— PHP å±æ€§ã€ç”¨ä¾‹ä»¥åŠæ›¿ä»£è¯­æ³•çš„æ›´æ·±å…¥çš„æ¦‚è¿°ã€‚

### å‘½åå‚æ•°

[å‘½åå‚æ•°](https://wiki.php.net/rfc/named_params)æä¾›äº†ä¸€ç§åœ¨ PHP ä¸­å°†å‚æ•°ä¼ é€’ç»™å‡½æ•°çš„æ–°æ–¹æ³•:

> å‘½åå‚æ•°å…è®¸æ ¹æ®å‚æ•°åè€Œä¸æ˜¯å‚æ•°ä½ç½®å‘å‡½æ•°ä¼ é€’å‚æ•°ã€‚

æˆ‘ä»¬å¯ä»¥é€šè¿‡ç®€å•åœ°åœ¨å‚æ•°å€¼å‰æ·»åŠ å‚æ•°åæ¥å°†å‘½åå‚æ•°ä¼ é€’ç»™å‡½æ•°:

```
callFunction(name: $value);
```

æˆ‘ä»¬ä¹Ÿå¯ä»¥ä½¿ç”¨ä¿ç•™å…³é”®å­—ï¼Œå¦‚ä¸‹ä¾‹æ‰€ç¤º:

```
callFunction(array: $value);
```

ä½†æ˜¯æˆ‘ä»¬ä¸å…è®¸åŠ¨æ€ä¼ é€’å‚æ•°åã€‚å‚æ•°å¿…é¡»æ˜¯æ ‡è¯†ç¬¦ï¼Œå¹¶ä¸”**ä¸å…è®¸ä½¿ç”¨ä»¥ä¸‹è¯­æ³•**:

```
callFunction($name: $value);
```

æ ¹æ® RFC çš„ä½œè€…å°¼åŸºå¡”Â·æ³¢æ³¢å¤«(Nikita Popov)çš„è¯´æ³•ï¼Œå‘½åè®ºè¯æœ‰å‡ ä¸ªä¼˜ç‚¹ã€‚

é¦–å…ˆï¼Œå‘½åå‚æ•°å°†å¸®åŠ©æˆ‘ä»¬ç¼–å†™æ›´å®¹æ˜“ç†è§£çš„ä»£ç ï¼Œå› ä¸ºå®ƒä»¬çš„å«ä¹‰æ˜¯ä¸è¨€è‡ªæ˜çš„ã€‚RFC ä¸­çš„ä»¥ä¸‹ç¤ºä¾‹ä¸è¨€è‡ªæ˜:

```
array_fill(start_index: 0, num: 100, value: 50);
```

å‘½åå‚æ•°ä¸é¡ºåºæ— å…³ã€‚è¿™æ„å‘³ç€æˆ‘ä»¬ä¸å¿…æŒ‰ç…§ä¸å‡½æ•°ç­¾åç›¸åŒçš„é¡ºåºå‘å‡½æ•°ä¼ é€’å‚æ•°:

éœ€è¦ä¸€ä¸ªéå¸¸å¿«é€Ÿã€å®‰å…¨ã€å¼€å‘è€…å‹å¥½çš„ç½‘ç«™æ‰˜ç®¡å—ï¼ŸKinsta æ˜¯ä¸º WordPress å¼€å‘è€…è®¾è®¡çš„ï¼Œæä¾›äº†å¤§é‡çš„å·¥å…·å’Œå¼ºå¤§çš„ä»ªè¡¨æ¿ã€‚[æŸ¥çœ‹æˆ‘ä»¬çš„è®¡åˆ’](https://kinsta.com/plans/?in-article-cta)

```
array_fill(value: 50, num: 100, start_index: 0);
```

è¿˜å¯ä»¥å°†å‘½åå‚æ•°ä¸ä½ç½®å‚æ•°ç»“åˆèµ·æ¥:

```
htmlspecialchars($string, double_encode: false);
```

å‘½åå‚æ•°çš„å¦ä¸€ä¸ªå¾ˆå¤§çš„ä¼˜ç‚¹æ˜¯ï¼Œå®ƒä»¬å…è®¸åªæŒ‡å®šé‚£äº›æˆ‘ä»¬æƒ³è¦æ”¹å˜çš„å‚æ•°ã€‚å¦‚æœæˆ‘ä»¬ä¸æƒ³è¦†ç›–é»˜è®¤å€¼ï¼Œå°±ä¸å¿…æŒ‡å®šé»˜è®¤å‚æ•°ã€‚æ¥è‡ª RFC çš„ä»¥ä¸‹ç¤ºä¾‹è¯´æ˜äº†è¿™ä¸€ç‚¹:

```
htmlspecialchars($string, default, default, false);
// vs
htmlspecialchars($string, double_encode: false);
```



### é‡è¦çš„

å¦‚æœä½ æ˜¯ä¸€ä¸ª [WordPress å¼€å‘è€…](https://kinsta.com/blog/hire-wordpress-developer/)ï¼Œè¯·æ³¨æ„åœ¨æ’°å†™æœ¬æ–‡æ—¶ï¼Œå‘½åå‚æ•°å¯èƒ½ä¼šå¯¼è‡´[å‘åå…¼å®¹é—®é¢˜](https://kinsta.com/blog/wordpress-5-6/#named-parameters)ã€‚æ²¡æœ‰ç»è¿‡æ·±æ€ç†Ÿè™‘çš„æµ‹è¯•ï¼Œä¸è¦åœ¨ç”Ÿäº§ä¸­ä½¿ç”¨å®ƒä»¬ã€‚



å‘½åå‚æ•°å¯ä»¥ä¸ [PHP å±æ€§](#attributes)ä¸€èµ·ä½¿ç”¨ï¼Œå¦‚ RFC çš„ä»¥ä¸‹ç¤ºä¾‹æ‰€ç¤º:

```
<<MyAttribute('A', b: 'B')>>
class Test {}
```

ä½†æ˜¯ï¼Œä¸å…è®¸åœ¨å‘½åå‚æ•°åä¼ é€’ä½ç½®å‚æ•°ï¼Œè¿™å°†å¯¼è‡´ç¼–è¯‘æ—¶é”™è¯¯ã€‚å½“æ‚¨ä¸¤æ¬¡ä¼ é€’ç›¸åŒçš„å‚æ•°åæ—¶ï¼Œä¹Ÿä¼šå‘ç”ŸåŒæ ·çš„æƒ…å†µã€‚

å‘½åå‚æ•°åœ¨ç±»å£°æ˜ä¸­å¾ˆæ–¹ä¾¿ï¼Œå› ä¸ºæ„é€ å‡½æ•°é€šå¸¸æœ‰è®¸å¤šå‚æ•°ï¼Œå‘½åå‚æ•°æä¾›äº†ä¸€ç§æ›´â€œç¬¦åˆäººä½“å·¥ç¨‹å­¦â€çš„æ–¹æ³•æ¥å£°æ˜ç±»ã€‚

å…³äºå‘½åå‚æ•°ã€çº¦æŸã€å‘åä¸å…¼å®¹æ€§å’Œå‡ ä¸ªä¾‹å­çš„æ›´è¯¦ç»†çš„è§†å›¾ï¼Œè¯·å‚è§[å‘½åå‚æ•° RFC](https://wiki.php.net/rfc/named_params) ã€‚

### ç©ºå®‰å…¨è¿ç®—ç¬¦

[è¿™ä¸ª RFC](https://wiki.php.net/rfc/nullsafe_operator) å¼•å…¥äº†å…·æœ‰å®Œå…¨[çŸ­è·¯è¯„ä¼°](https://en.wikipedia.org/wiki/Short-circuit_evaluation)çš„ç©ºå®‰å…¨æ“ä½œç¬¦`$->`ã€‚

åœ¨çŸ­è·¯è¯„ä¼°ä¸­ï¼Œåªæœ‰å½“ç¬¬ä¸€ä¸ªæ“ä½œç¬¦æ²¡æœ‰è¯„ä¼°åˆ°`null`æ—¶ï¼Œæ‰è¯„ä¼°ç¬¬äºŒä¸ªæ“ä½œç¬¦ã€‚å¦‚æœä¸€ä¸ªé“¾ä¸­çš„ä¸€ä¸ªæ“ä½œç¬¦è¯„ä¼°ä¸º`null`ï¼Œæ•´ä¸ªé“¾çš„æ‰§è¡Œåœæ­¢å¹¶è¯„ä¼°ä¸º`null`ã€‚

è€ƒè™‘æ¥è‡ª RFC çš„ä»¥ä¸‹ç¤ºä¾‹:

```
$foo = $a?->b();
```

å¦‚æœ`$a`ä¸ºç©ºï¼Œåˆ™ä¸è°ƒç”¨æ–¹æ³•`b()`ï¼Œå¹¶å°†`$foo`è®¾ç½®ä¸º`null`ã€‚

å‚è§ [nullsafe æ“ä½œç¬¦ RFC](https://wiki.php.net/rfc/nullsafe_operator) ,äº†è§£æ›´å¤šç¤ºä¾‹ã€å¼‚å¸¸å’Œæœªæ¥èŒƒå›´ã€‚

### æ¯”è¾ƒå­—ç¬¦ä¸²å’Œæ•°å­—

åœ¨ä»¥å‰çš„ PHP ç‰ˆæœ¬ä¸­ï¼Œå½“åœ¨å­—ç¬¦ä¸²å’Œæ•°å­—ä¹‹é—´è¿›è¡Œéä¸¥æ ¼æ¯”è¾ƒæ—¶ï¼ŒPHP é¦–å…ˆå°†å­—ç¬¦ä¸²è½¬æ¢ä¸ºæ•°å­—ï¼Œç„¶åæ‰§è¡Œæ•´æ•°æˆ–æµ®ç‚¹æ•°ä¹‹é—´çš„æ¯”è¾ƒã€‚å³ä½¿è¿™ç§è¡Œä¸ºåœ¨æŸäº›æƒ…å†µä¸‹éå¸¸æœ‰ç”¨ï¼Œå®ƒä¹Ÿå¯èƒ½äº§ç”Ÿé”™è¯¯çš„ç»“æœï¼Œä»è€Œå¯¼è‡´é”™è¯¯å’Œ/æˆ–å®‰å…¨é—®é¢˜ã€‚

è€ƒè™‘æ¥è‡ª RFC çš„ä»¥ä¸‹ç¤ºä¾‹:

```
$validValues = ["foo", "bar", "baz"];
$value = 0;
var_dump(in_array($value, $validValues));
// bool(true)
```

PHP 8 å¼•å…¥äº†[æ›´åˆç†çš„å­—ç¬¦ä¸²åˆ°æ•°å­—çš„æ¯”è¾ƒ](https://wiki.php.net/rfc/string_to_number_comparison)ï¼Œæ—¨åœ¨ä½¿å­—ç¬¦ä¸²åˆ°æ•°å­—çš„æ¯”è¾ƒæ›´åŠ åˆç†ã€‚ç”¨å°¼åŸºå¡”Â·æ³¢æ³¢å¤«çš„è¯è¯´ï¼Œ

> è¿™ä¸ª RFC æ—¨åœ¨ç»™å­—ç¬¦ä¸²ä¸æ•°å­—çš„æ¯”è¾ƒä¸€ä¸ªæ›´åˆç†çš„è¡Œä¸º:å½“ä¸æ•°å­—å­—ç¬¦ä¸²æ¯”è¾ƒæ—¶ï¼Œä½¿ç”¨æ•°å­—æ¯”è¾ƒ(å’Œç°åœ¨ä¸€æ ·)ã€‚å¦åˆ™ï¼Œå°†æ•°å­—è½¬æ¢ä¸ºå­—ç¬¦ä¸²ï¼Œå¹¶ä½¿ç”¨å­—ç¬¦ä¸²æ¯”è¾ƒã€‚

ä¸‹è¡¨æ¯”è¾ƒäº† PHP æ—©æœŸç‰ˆæœ¬å’Œ PHP 8 ä¸­å­—ç¬¦ä¸²ä¸æ•°å­—æ¯”è¾ƒçš„è¡Œä¸º:

```
Comparison    | Before | After
------------------------------
 0 == "0"     | true   | true
 0 == "0.0"   | true   | true
 0 == "foo"   | true   | false
 0 == ""      | true   | false
42 == "   42" | true   | true
42 == "42foo" | true   | false
```

åœ¨å°¼åŸºå¡”Â·æ³¢æ³¢å¤«çš„å®˜æ–¹ [RFC ä¸­ï¼Œé˜…è¯»æ›´å¤šå…³äºè¿™ä¸€å˜åŒ–çš„å«ä¹‰ä»¥åŠ PHP 8 ä¸­å­—ç¬¦ä¸²å’Œæ•°å­—æ¯”è¾ƒçš„å˜åŒ–ã€‚](https://wiki.php.net/rfc/string_to_number_comparison)

### Saner æ•°å­—å­—ç¬¦ä¸²

åœ¨ PHP ä¸­ï¼ŒåŒ…å«æ•°å­—çš„å­—ç¬¦ä¸²åˆ†ä¸ºä¸‰ç±»:

*   **æ•°å­—å­—ç¬¦ä¸²**:åŒ…å«ä¸€ä¸ªæ•°å­—çš„å­—ç¬¦ä¸²ï¼Œå‰é¢å¯ä»¥æœ‰ç©ºæ ¼ã€‚
*   **å‰å¯¼æ•°å­—ä¸²**:èµ·å§‹å­—ç¬¦ä¸ºæ•°å­—ä¸²ï¼Œå°¾éšå­—ç¬¦ä¸ºéæ•°å­—ä¸²ã€‚
*   **éæ•°å­—å­—ç¬¦ä¸²**:ä¸å±äºä¸Šè¿°ä¸¤ä¸ªç±»åˆ«çš„å­—ç¬¦ä¸²ã€‚

æ ¹æ®æ‰€æ‰§è¡Œçš„æ“ä½œï¼Œæ•°å­—å­—ç¬¦ä¸²å’Œå‰å¯¼æ•°å­—å­—ç¬¦ä¸²çš„å¤„ç†æ–¹å¼ä¸åŒã€‚ä¾‹å¦‚:

*   **æ˜¾å¼å­—ç¬¦ä¸²åˆ°æ•°å­—çš„è½¬æ¢**(å³`(int)`å’Œ`(float)`ç±»å‹è½¬æ¢)è½¬æ¢æ•°å­—å’Œå‰å¯¼æ•°å­—å­—ç¬¦ä¸²ã€‚å°†éæ•°å­—å­—ç¬¦ä¸²æ˜¾å¼è½¬æ¢ä¸ºæ•°å­—ä¼šäº§ç”Ÿ 0ã€‚
*   **éšå¼å­—ç¬¦ä¸²åˆ°æ•°å­—çš„è½¬æ¢**(å³æ²¡æœ‰`strict_type`å£°æ˜)å¯¼è‡´æ•°å­—å’Œéæ•°å­—å­—ç¬¦ä¸²çš„ç»“æœä¸åŒã€‚éæ•°å­—å­—ç¬¦ä¸²åˆ°æ•°å­—çš„è½¬æ¢æŠ›å‡ºä¸€ä¸ª`TypeError`ã€‚
*   `is_numeric()`ä»…å¯¹æ•°å­—å­—ç¬¦ä¸²è¿”å›**çœŸ**ã€‚

å­—ç¬¦ä¸²åç§»é‡ã€ç®—æœ¯è¿ç®—ã€é€’å¢å’Œé€’å‡è¿ç®—ã€å­—ç¬¦ä¸²ä¹‹é—´çš„æ¯”è¾ƒä»¥åŠæŒ‰ä½è¿ç®—ä¹Ÿä¼šå¯¼è‡´ä¸åŒçš„ç»“æœã€‚

[æœ¬ RFC](https://wiki.php.net/rfc/saner-numeric-strings) æè®®:

> å°†å„ç§æ•°å­—å­—ç¬¦ä¸²æ¨¡å¼ç»Ÿä¸€åˆ°ä¸€ä¸ªæ¦‚å¿µä¸­:æ•°å­—å­—ç¬¦åªå…è®¸æœ‰å‰å¯¼å’Œå°¾éšç©ºæ ¼ã€‚ä»»ä½•å…¶ä»–ç±»å‹çš„å­—ç¬¦ä¸²éƒ½æ˜¯éæ•°å­—çš„ï¼Œåœ¨æ•°å­—ä¸Šä¸‹æ–‡ä¸­ä½¿ç”¨æ—¶ä¼šå¼•å‘ TypeErrorsã€‚

> è¿™æ„å‘³ç€ï¼Œæ‰€æœ‰å½“å‰å‘å‡º **E_NOTICE** â€œé‡åˆ°æ ¼å¼ä¸æ­£ç¡®çš„æ•°å€¼â€çš„å­—ç¬¦ä¸²å°†è¢«é‡æ–°åˆ†ç±»åˆ° **E_WARNING** â€œé‡åˆ°éæ•°å€¼â€ä¸­ï¼Œé™¤éå‰å¯¼æ•°å­—å­—ç¬¦ä¸²ä»…åŒ…å«å°¾éšç©ºæ ¼ã€‚å¹¶ä¸”å½“å‰å‘å‡º **E_WARNING** çš„å„ç§æƒ…å†µå°†è¢«æå‡åˆ°`TypeError` sã€‚

å…³äº PHP 8 ä¸­æ•°å­—å­—ç¬¦ä¸²çš„æ›´æ·±å…¥çš„æ¦‚è¿°ï¼ŒåŒ…æ‹¬ä»£ç ç¤ºä¾‹ã€å¼‚å¸¸å’Œå‘åå…¼å®¹æ€§é—®é¢˜ï¼Œè¯·å‚è§ [RFC](https://wiki.php.net/rfc/saner-numeric-strings) ã€‚

### åŒ¹é…è¡¨è¾¾å¼ v2

æ–°çš„`match`è¡¨è¾¾å¼ä¸`switch`éå¸¸ç›¸ä¼¼ï¼Œä½†æ˜¯å…·æœ‰æ›´å®‰å…¨çš„è¯­ä¹‰å¹¶å…è®¸è¿”å›å€¼ã€‚

ä¸ºäº†ç†è§£è¿™ä¸¤ç§æ§åˆ¶ç»“æ„ä¹‹é—´çš„åŒºåˆ«ï¼Œè€ƒè™‘ä¸‹é¢æ¥è‡ª [RFC](https://wiki.php.net/rfc/match_expression_v2) çš„`switch`ç¤ºä¾‹:

```
switch (1) {
	case 0:
		$result = 'Foo';
		break;
	case 1:
		$result = 'Bar';
		break;
	case 2:
		$result = 'Baz';
		break;
}

echo $result;
//> Bar
```

æˆ‘ä»¬ç°åœ¨å¯ä»¥ç”¨ä¸‹é¢çš„`match`è¡¨è¾¾å¼å¾—åˆ°ä¸ä¸Šé¢ä»£ç ç›¸åŒçš„ç»“æœ:

```
echo match (1) {
	0 => 'Foo',
	1 => 'Bar',
	2 => 'Baz',
};
//> Bar
```

ä½¿ç”¨æ–°çš„`match`è¡¨è¾¾å¼çš„ä¸€ä¸ªæ˜¾è‘—ä¼˜ç‚¹æ˜¯ï¼Œè™½ç„¶`switch`æ¾æ•£åœ°æ¯”è¾ƒå€¼(`==`)å¯èƒ½ä¼šå¯¼è‡´æ„æƒ³ä¸åˆ°çš„ç»“æœï¼Œä½†æ˜¯ä½¿ç”¨`match`è¿›è¡Œæ¯”è¾ƒæ˜¯ä¸€ç§èº«ä»½æ£€æŸ¥(`===`)ã€‚

`match`è¡¨è¾¾å¼ä¹Ÿå¯ä»¥åŒ…å«å¤šä¸ªé€—å·åˆ†éš”çš„è¡¨è¾¾å¼ï¼Œä»¥å…è®¸æ›´ç®€æ´çš„è¯­æ³•([æ¥æº](https://www.php.net/manual/en/control-structures.match.php)):

```
$result = match ($x) {
	// This match arm:
	$a, $b, $c => 5,
	// Is equivalent to these three match arms:
	$a => 5,
	$b => 5,
	$c => 5,
};
```

å¦‚éœ€æ›´å¤šä½¿ç”¨ç¤ºä¾‹å’Œæ¡ˆä¾‹ï¼Œè¯·å‚è§[åŒ¹é…è¡¨è¾¾å¼ v2 RFC](https://wiki.php.net/rfc/match_expression_v2) å’Œ [PHP æ–‡æ¡£](https://www.php.net/manual/en/control-structures.match.php)ã€‚

### ç®—æœ¯/æŒ‰ä½è¿ç®—ç¬¦çš„æ›´ä¸¥æ ¼çš„ç±»å‹æ£€æŸ¥

åœ¨ä»¥å‰çš„ PHP ç‰ˆæœ¬ä¸­ï¼Œå…è®¸å¯¹æ•°ç»„ã€èµ„æºæˆ–éé‡è½½å¯¹è±¡åº”ç”¨[ç®—æœ¯](https://www.php.net/manual/en/language.operators.arithmetic.php)å’Œ[æŒ‰ä½](https://www.php.net/manual/en/language.operators.bitwise.php)è¿ç®—ç¬¦ã€‚æ— è®ºå¦‚ä½•ï¼Œè¡Œä¸ºæœ‰æ—¶æ˜¯ä¸ä¸€è‡´çš„ã€‚

åœ¨è¿™ä¸ª RFC ä¸­ï¼Œå°¼åŸºå¡”Â·æ³¢æ³¢å¤«ç”¨ä¸€ä¸ªç®€å•çš„ä¾‹å­å±•ç¤ºäº†è¿™ç§è¡Œä¸ºæ˜¯å¤šä¹ˆä¸åˆç†:

```
var_dump([] % [42]);
// int(0)
```

Nikita è§£é‡Šäº†å¦‚ä½•å°†ç®—æœ¯æˆ–æŒ‰ä½è¿ç®—ç¬¦åº”ç”¨äºæ•°ç»„ã€èµ„æºæˆ–éé‡è½½å¯¹è±¡[ä¼šå¯¼è‡´ä¸åŒçš„ç»“æœ](https://wiki.php.net/rfc/arithmetic_operator_type_checks#current_behavior):

> è¿ç®—ç¬¦+ã€-ã€*ã€/ã€**:
> 
> *   å¯¹æ•°ç»„æ“ä½œæ•°æŠ›å‡ºé”™è¯¯å¼‚å¸¸ã€‚(å¦‚æœä¸¤ä¸ªæ“ä½œæ•°éƒ½æ˜¯æ•°ç»„ï¼Œåˆ™ä¸åŒ…æ‹¬+ã€‚)
> *   é™é»˜åœ°å°†èµ„æºæ“ä½œæ•°è½¬æ¢ä¸ºæ•´æ•°å½¢å¼çš„èµ„æº IDã€‚
> *   å°†ä¸€ä¸ªå¯¹è±¡æ“ä½œæ•°è½¬æ¢ä¸ºæ•´æ•° 1ï¼ŒåŒæ—¶æŠ›å‡ºä¸€ä¸ªé€šçŸ¥ã€‚
> 
> è¿ç®—ç¬¦%ï¼Œ<>ï¼Œ&ï¼Œ|ï¼Œ^:
> 
> *   å¦‚æœä¸ºç©ºï¼Œåˆ™é™é»˜åœ°å°†æ•°ç»„æ“ä½œæ•°è½¬æ¢ä¸ºæ•´æ•°é›¶ï¼Œå¦‚æœä¸ºéç©ºï¼Œåˆ™è½¬æ¢ä¸ºæ•´æ•°ä¸€ã€‚
> *   é™é»˜åœ°å°†èµ„æºæ“ä½œæ•°è½¬æ¢ä¸ºæ•´æ•°å½¢å¼çš„èµ„æº IDã€‚
> *   å°†ä¸€ä¸ªå¯¹è±¡æ“ä½œæ•°è½¬æ¢ä¸ºæ•´æ•° 1ï¼ŒåŒæ—¶æŠ›å‡ºä¸€ä¸ªé€šçŸ¥ã€‚
> 
> æ“ä½œå‘˜~:
> 
> *   å¼•å‘æ•°ç»„ã€èµ„æºå’Œå¯¹è±¡æ“ä½œæ•°çš„é”™è¯¯å¼‚å¸¸ã€‚
> 
> è¿ç®—ç¬¦++å’Œ-:
> 
> *   å¦‚æœæ“ä½œæ•°æ˜¯æ•°ç»„ã€èµ„æºæˆ–å¯¹è±¡ï¼Œåˆ™ä¸æ‰§è¡Œä»»ä½•æ“ä½œã€‚

åœ¨ PHP 8 ä¸­ï¼Œäº‹æƒ…å‘ç”Ÿäº†å˜åŒ–ï¼Œæ‰€æœ‰ç®—æœ¯å’Œä½è¿ç®—ç¬¦çš„è¡Œä¸ºéƒ½æ˜¯ä¸€æ ·çš„:

**ä¸ºæ•°ç»„ã€èµ„æºå’Œå¯¹è±¡æ“ä½œæ•°æŠ›å‡ºä¸€ä¸ª`TypeError`å¼‚å¸¸ã€‚ã€T2
**

## æ–°çš„ PHP å‡½æ•°

PHP 8 ä¸ºè¯¥è¯­è¨€å¸¦æ¥äº†å‡ ä¸ªæ–°åŠŸèƒ½:

### str _ åŒ…å«

åœ¨ PHP 8 ä¹‹å‰ï¼Œ [strstr](https://www.php.net/manual/en/function.strstr.php) å’Œ [strpos](https://www.php.net/manual/en/function.strpos.php) æ˜¯[å¼€å‘è€…](https://kinsta.com/blog/hire-wordpress-developer/)åœ¨ç»™å®šå­—ç¬¦ä¸²ä¸­æœç´¢æŒ‡é’ˆçš„å…¸å‹é€‰é¡¹ã€‚é—®é¢˜æ˜¯è¿™ä¸¤ä¸ªå‡½æ•°éƒ½ä¸å¤ªç›´è§‚ï¼Œå®ƒä»¬çš„ç”¨æ³•å¯èƒ½ä¼šè®©æ–°çš„ PHP å¼€å‘äººå‘˜æ„Ÿåˆ°å›°æƒ‘ã€‚è¯·å‚è§ä»¥ä¸‹ç¤ºä¾‹:

```
$mystring = 'Managed WordPress Hosting';
$findme = 'WordPress';
$pos = strpos($mystring, $findme);

if ($pos !== false) {
	echo "The string has been found";
} else {
	echo "String not found";
}
```

åœ¨ä¸Šé¢çš„ä¾‹å­ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨äº†`!==`æ¯”è¾ƒæ“ä½œç¬¦ï¼Œå®ƒæ£€æŸ¥ä¸¤ä¸ªå€¼æ˜¯å¦å±äºåŒä¸€ç±»å‹ã€‚è¿™é˜²æ­¢æˆ‘ä»¬åœ¨æŒ‡é’ˆä½ç½®ä¸º 0 æ—¶å¾—åˆ°é”™è¯¯[:](https://www.php.net/manual/en/function.strpos.php#refsect1-function.strpos-returnvalues)

> è¯¥å‡½æ•°å¯èƒ½è¿”å›å¸ƒå°”å€¼**å‡**ï¼Œä½†ä¹Ÿå¯èƒ½è¿”å›è¯„ä¼°ä¸º**å‡**çš„éå¸ƒå°”å€¼ã€‚[â€¦]ä½¿ç”¨===è¿ç®—ç¬¦æµ‹è¯•æ­¤å‡½æ•°çš„è¿”å›å€¼ã€‚

æ­¤å¤–ï¼Œä¸€äº›æ¡†æ¶æä¾›äº†åŠ©æ‰‹å‡½æ•°æ¥æœç´¢ç»™å®šå­—ç¬¦ä¸²ä¸­çš„å€¼(ä¾‹å¦‚ï¼Œå‚è§ [Laravel åŠ©æ‰‹æ–‡æ¡£](https://laravel.com/docs/7.x/helpers#method-str-contains))ã€‚

ç°åœ¨ï¼Œ[è¿™ä¸ª RFC](https://wiki.php.net/rfc/str_contains) æè®®å¼•å…¥ä¸€ä¸ªæ–°çš„å‡½æ•°ï¼Œå…è®¸åœ¨å­—ç¬¦ä¸²å†…éƒ¨è¿›è¡Œæœç´¢:`str_contains`ã€‚

```
str_contains ( string $haystack , string $needle ) : bool
```

å®ƒçš„ç”¨æ³•éå¸¸ç®€å•ã€‚`str_contains`æ£€æŸ¥`$needle`æ˜¯å¦åœ¨`$haystack`ä¸­æ‰¾åˆ°ï¼Œå¹¶ç›¸åº”è¿”å›`true`æˆ–`false`ã€‚

æ‰€ä»¥ï¼Œå¤šäºäº†`str_contains`ï¼Œæˆ‘ä»¬å¯ä»¥ç¼–å†™ä»¥ä¸‹ä»£ç :

```
$mystring = 'Managed WordPress Hosting';
$findme   = 'WordPress';

if (str_contains($mystring, $findme)) {
	echo "The string has been found";
} else {
	echo "String not found";
}
```

è¿™æ ·å¯è¯»æ€§æ›´å¥½ï¼Œä¹Ÿä¸å®¹æ˜“å‡ºé”™(è§è¿™é‡Œä¸­çš„è¿™æ®µä»£ç )ã€‚
åœ¨æ’°å†™æœ¬æ–‡æ—¶ï¼Œ`str_contains`åŒºåˆ†å¤§å°å†™ï¼Œä½†å°†æ¥å¯èƒ½ä¼šæ”¹å˜ã€‚

ææ¡ˆä»¥ 43 ç¥¨å¯¹ 9 ç¥¨é€šè¿‡ã€‚

### str_starts_with()å’Œ str_ends_with()

é™¤äº†`str_contains`å‡½æ•°ä¹‹å¤–ï¼Œä¸¤ä¸ªæ–°çš„å‡½æ•°å…è®¸åœ¨ç»™å®šçš„å­—ç¬¦ä¸²ä¸­æœç´¢é’ˆ:`str_starts_with`å’Œ`str_ends_with`ã€‚

[è¿™äº›æ–°å‡½æ•°](https://wiki.php.net/rfc/add_str_starts_with_and_ends_with_functions)æ£€æŸ¥ä¸€ä¸ªç»™å®šçš„å­—ç¬¦ä¸²æ˜¯ä»¥å¦ä¸€ä¸ªå­—ç¬¦ä¸²å¼€å§‹è¿˜æ˜¯ç»“æŸ:

```
str_starts_with (string $haystack , string $needle) : bool
str_ends_with (string $haystack , string $needle) : bool
```

å¦‚æœ`$needle`æ¯”`$haystack`é•¿ï¼Œä¸¤ä¸ªå‡½æ•°éƒ½è¿”å›`false`ã€‚

æ ¹æ® RFC çš„ä½œè€…å¨å°”Â·å“ˆé‡‘æ–¯çš„è¯´æ³•ï¼Œ

> â€œå¯¹`str_starts_with`å’Œ`str_ends_with`åŠŸèƒ½çš„éœ€æ±‚å¦‚æ­¤æ™®éï¼Œä»¥è‡³äºè®¸å¤š[ä¸»æµ PHP æ¡†æ¶](https://kinsta.com/blog/php-frameworks/)éƒ½æ”¯æŒå®ƒï¼ŒåŒ…æ‹¬ [Symfony](https://symfony.com/doc/5.0/components/string.html#methods-to-search-and-replace) ã€ [Laravel](https://laravel.com/docs/7.x/helpers#method-starts-with) ã€ [Yii](https://www.yiiframework.com/doc/api/2.0/yii-helpers-basestringhelper#startsWith()-detail) ã€ [FuelPHP](https://fuelphp.com/docs/classes/str.html#/method_starts_with) å’Œ [Phalcon](https://docs.phalcon.io/3.4/en/api/phalcon_text) ã€‚â€

å¤šäºäº†å®ƒä»¬ï¼Œæˆ‘ä»¬ç°åœ¨å¯ä»¥é¿å…ä½¿ç”¨æ¬¡ä¼˜å’Œä¸å¤ªç›´è§‚çš„å‡½æ•°ï¼Œæ¯”å¦‚`substr`ã€`strpos`ã€‚ä¸¤ä¸ªå‡½æ•°éƒ½åŒºåˆ†å¤§å°å†™:

```
$str = "WordPress";
if (str_starts_with($str, "Word")) echo "Found!";

if (str_starts_with($str, "word")) echo "Not found!";
```

ä½ å¯ä»¥åœ¨è¿™é‡Œçœ‹åˆ°è¿™æ®µä»£ç çš„è¿è¡Œ[ã€‚](https://3v4l.org/kBcjZ/rfc#output)

è¯¥ RFC ä»¥ 51 ç¥¨å¯¹ 4 ç¥¨è·å¾—æ‰¹å‡†ã€‚

### è·å–è°ƒè¯•ç±»å‹

`get_debug_type`æ˜¯ä¸€ä¸ªæ–°çš„ PHP å‡½æ•°ï¼Œå®ƒè¿”å›å˜é‡çš„ç±»å‹ã€‚æ–°å‡½æ•°çš„å·¥ä½œæ–¹å¼ä¸ [`gettype`å‡½æ•°](https://www.php.net/manual/en/function.gettype.php)éå¸¸ç›¸ä¼¼ï¼Œä½†æ˜¯`get_debug_type`è¿”å›æœ¬æœºç±»å‹åå¹¶è§£æç±»åã€‚

è¿™å¯¹è¯­è¨€æ¥è¯´æ˜¯ä¸€ä¸ªå¾ˆå¥½çš„æ”¹è¿›ï¼Œå› ä¸º`gettype()`å¯¹ç±»å‹æ£€æŸ¥æ²¡æœ‰ç”¨ã€‚

RFC æä¾›äº†ä¸¤ä¸ªæœ‰ç”¨çš„ä¾‹å­æ¥ç†è§£æ–°çš„`get_debug_type()`å‡½æ•°å’Œ`gettype()`å‡½æ•°ä¹‹é—´çš„åŒºåˆ«ã€‚ç¬¬ä¸€ä¸ªä¾‹å­æ˜¾ç¤ºäº†`gettype`åœ¨èµ·ä½œç”¨:

```
$bar = [1,2,3];

if (!($bar instanceof Foo)) { 
	throw new TypeError('Expected ' . Foo::class . ', got ' . (is_object($bar) ? get_class($bar) : gettype($bar)));
}
```

åœ¨ PHP 8 ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨`get_debug_type`æ¥ä»£æ›¿:

```
if (!($bar instanceof Foo)) { 
	throw new TypeError('Expected ' . Foo::class . ' got ' . get_debug_type($bar));
}
```

ä¸‹è¡¨æ˜¾ç¤ºäº†`get_debug_type`å’Œ`gettype`çš„è¿”å›å€¼:

| ä»·å€¼ | gettype() | get_debug_type() |
| --- | --- | --- |
| one | æ•´æ•° | ï¼ˆåŒ Internationalorganizationsï¼‰å›½é™…ç»„ç»‡ |
| Zero point one | ä¸¤å€ | æ¼‚æµ®ç‰© |
| çœŸå®çš„ | å¸ƒå°”å‹ | å¼¯æ›²ä»¶ |
| é”™è¯¯çš„ | å¸ƒå°”å‹ | å¼¯æ›²ä»¶ |
| ç©º | ç©º | ç©º |
| " WordPress " | çº¿ | çº¿ |
| [1,2,3] | æ’åˆ— | æ’åˆ— |
| åä¸ºâ€œFoo\Barâ€çš„ç±» | ç›®æ ‡ | é˜¿å®½ |
| åŒ¿åç­çº§ | ç›®æ ‡ | [ã€ç”µå­é‚®ä»¶ä¿æŠ¤ã€‘](/cdn-cgi/l/email-protection) |

## é™„åŠ  RFC

ä¸‹é¢æ˜¯ PHP 8 ä¸­é¢å¤–æ‰¹å‡†çš„æ”¹è¿›çš„å¿«é€Ÿåˆ—è¡¨:

1.  **Stringable æ¥å£** : [è¿™ä¸ª RFC](https://wiki.php.net/rfc/stringable) å¼•å…¥äº†ä¸€ä¸ª Stringable æ¥å£ï¼Œå®ƒè¢«è‡ªåŠ¨æ·»åŠ åˆ°å®ç° [`__to String()`æ–¹æ³•](https://www.php.net/manual/en/language.oop5.magic.php#object.tostring)çš„ç±»ä¸­ã€‚è¿™é‡Œçš„ä¸»è¦ç›®æ ‡æ˜¯ä½¿ç”¨`string|Stringable`è”åˆç±»å‹ã€‚
2.  **ext/DOM ä¸­æ–°çš„ DOM live Standard API**:[è¿™ä¸ª RFC](https://wiki.php.net/rfc/dom_living_standard_api) æå‡ºé€šè¿‡å¼•å…¥æ–°çš„æ¥å£å’Œå…¬å…±å±æ€§æ¥å®ç°å½“å‰çš„[DOM live Standard](https://dom.spec.whatwg.org/)åˆ° [PHP DOM æ‰©å±•](https://www.php.net/manual/en/intro.dom.php)ã€‚
3.  **é™æ€è¿”å›ç±»å‹** : PHP 8 åœ¨`self`å’Œ`parent`ç±»å‹æ—è¾¹ä»‹ç»äº†`static`ä½œä¸ºè¿”å›ç±»å‹çš„ç”¨æ³•ã€‚
4.  **å˜é‡è¯­æ³•è°ƒæ•´** : [è¿™ä¸ª RFC](https://wiki.php.net/rfc/variable_syntax_tweaks) è§£å†³äº† PHP å˜é‡è¯­æ³•ä¸­ä¸€äº›æ®‹ç•™çš„ä¸ä¸€è‡´ã€‚

## PHP 8 æ€§èƒ½åŸºå‡†

å¦‚æœä½ æƒ³çŸ¥é“ PHP 8 æœ‰å¤šå¿«ï¼Œæˆ‘ä»¬æœ‰ç­”æ¡ˆã€‚æˆ‘ä»¬[åœ¨ 7 ä¸ªä¸åŒçš„ PHP ç‰ˆæœ¬(5.6ã€7.0ã€7.1ã€7.2ã€7.3 å’Œ 8.0)ä¸Šå¯¹ 20 ä¸ª PHP å¹³å°/é…ç½®](https://kinsta.com/blog/php-benchmarks/)è¿›è¡Œäº†åŸºå‡†æµ‹è¯•ã€‚

PHP 8.0 åœ¨å¤§å¤šæ•°æ”¯æŒå®ƒçš„å¹³å°ä¸Šè„±é¢–è€Œå‡ºï¼ŒåŒ…æ‹¬ WordPress å’Œ Laravelã€‚

![Compiled PHP benchmarks of the top platforms](img/13b215f655591b93991eff49dc083198.png)

Compiled PHP benchmarks of the top platforms



ä¾‹å¦‚ï¼ŒPHP 8.0 ä¸Šçš„ WordPress æ¯ç§’å¯ä»¥å¤„ç†æ¯” PHP 7.4 å¤š 18.4%çš„è¯·æ±‚ã€‚åŒæ ·ï¼ŒPHP 8.0 ä¸Šçš„ Laravel æ¯ç§’å¯ä»¥æ¯” PHP 7.3 å¤šè¿è¡Œ **8.5%** ä¸ªè¯·æ±‚ã€‚

å¦‚æœä½ çš„ç½‘ç«™æˆ–åº”ç”¨å®Œå…¨å…¼å®¹ PHP 8.0ï¼Œä½ åº”è¯¥è®¡åˆ’[å°½å¿«å°†ä½ çš„æœåŠ¡å™¨ç¯å¢ƒæ›´æ–°åˆ° PHP 8.0](https://kinsta.com/feature-updates/php-8/) ã€‚æ‚¨(å’Œæ‚¨çš„ç”¨æˆ·)ä¸€å®šä¼šæ¬£èµå®ƒçš„æ€§èƒ½ä¼˜åŠ¿ã€‚ä½†æ˜¯ï¼Œè¯·åœ¨æ›´æ–°å‰å½»åº•æµ‹è¯•æ‚¨çš„ç½‘ç«™ã€‚

æ‚¨å¯ä»¥é˜…è¯»æˆ‘ä»¬çš„ [PHP åŸºå‡†æµ‹è¯•æ–‡ç« ](https://kinsta.com/blog/php-benchmarks/)ä»¥è·å¾—æ›´å¤šä¿¡æ¯ï¼Œä¾‹å¦‚è¯¦ç»†çš„æ€§èƒ½æ•°æ®ã€è§è§£å’Œæ¼‚äº®çš„å›¾è¡¨ï¼

[PHP 8 has been released to the GA and brings lots of optimizations and features to the language. ğŸš€ Check out our deep dive into PHP 8!Click to Tweet](https://twitter.com/intent/tweet?url=https%3A%2F%2Fkinsta.com%2Fblog%2Fphp-8%2F&via=kinsta&text=PHP+8+has+been+released+to+the+GA+and+brings+lots+of+optimizations+and+features+to+the+language.+%F0%9F%9A%80+Check+out+our+deep+dive+into+PHP+8%21&hashtags=PHP%2Cwebdev)

## æ‘˜è¦

å¤šå¥½çš„æ—…ç¨‹å•Šï¼åœ¨è¿™ç¯‡æ–‡ç« ä¸­ï¼Œæˆ‘ä»¬ä»‹ç»äº† PHP 8 æœ€æœ‰è¶£çš„ä¼˜åŒ–å’Œç‰¹æ€§ã€‚æœ€ä»¤äººæœŸå¾…çš„å½“ç„¶æ˜¯å³æ—¶ç¼–è¯‘å™¨ï¼Œä½†æ˜¯ PHP 8 è¿˜æœ‰æ›´å¤šã€‚

è¯·ç¡®ä¿å°†è¿™ç¯‡åšå®¢æ–‡ç« åŠ å…¥ä¹¦ç­¾ï¼Œä»¥ä¾›å°†æ¥å‚è€ƒã€‚ğŸ¤“

ç°åœ¨è½®åˆ°ä½ äº†:ä½ å‡†å¤‡å¥½æµ‹è¯•æ–°çš„ PHP ç‰¹æ€§äº†å—ï¼Ÿä½ æœ€å–œæ¬¢å“ªä¸€ä¸ªï¼Ÿåœ¨ä¸‹é¢çš„è¯„è®ºæ é‡Œå†™ä¸€è¡Œã€‚

* * *

è®©ä½ æ‰€æœ‰çš„[åº”ç”¨ç¨‹åº](https://kinsta.com/application-hosting/)ã€[æ•°æ®åº“](https://kinsta.com/database-hosting/)å’Œ [WordPress ç½‘ç«™](https://kinsta.com/wordpress-hosting/)åœ¨çº¿å¹¶åœ¨ä¸€ä¸ªå±‹æªä¸‹ã€‚æˆ‘ä»¬åŠŸèƒ½ä¸°å¯Œçš„é«˜æ€§èƒ½äº‘å¹³å°åŒ…æ‹¬:

*   åœ¨ MyKinsta ä»ªè¡¨ç›˜ä¸­è½»æ¾è®¾ç½®å’Œç®¡ç†
*   24/7 ä¸“å®¶æ”¯æŒ
*   æœ€å¥½çš„è°·æ­Œäº‘å¹³å°ç¡¬ä»¶å’Œç½‘ç»œï¼Œç”± Kubernetes æä¾›æœ€å¤§çš„å¯æ‰©å±•æ€§
*   é¢å‘é€Ÿåº¦å’Œå®‰å…¨æ€§çš„ä¼ä¸šçº§ Cloudflare é›†æˆ
*   å…¨çƒå—ä¼—è¦†ç›–å…¨çƒå¤šè¾¾ 35 ä¸ªæ•°æ®ä¸­å¿ƒå’Œ 275 å¤šä¸ª pop

åœ¨ç¬¬ä¸€ä¸ªæœˆä½¿ç”¨æ‰˜ç®¡çš„[åº”ç”¨ç¨‹åºæˆ–æ‰˜ç®¡](https://kinsta.com/application-hosting/)çš„[æ•°æ®åº“ï¼Œæ‚¨å¯ä»¥äº«å— 20 ç¾å…ƒçš„ä¼˜æƒ ï¼Œäº²è‡ªæµ‹è¯•ä¸€ä¸‹ã€‚æ¢ç´¢æˆ‘ä»¬çš„](https://kinsta.com/database-hosting/)[è®¡åˆ’](https://kinsta.com/plans/)æˆ–[ä¸é”€å”®äººå‘˜äº¤è°ˆ](https://kinsta.com/contact-us/)ä»¥æ‰¾åˆ°æœ€é€‚åˆæ‚¨çš„æ–¹å¼ã€‚